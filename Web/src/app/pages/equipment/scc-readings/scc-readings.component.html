<!-- SCC (System Control Cabinet) Readings Page -->
<div class="container-fluid ats-readings-container">
  <!-- Header: Back, Title, Save -->
  <div class="ats-readings-header__top mb-4 d-flex justify-content-between align-items-center">
    <button type="button" class="btn btn-sm btn-primary ats-readings-header__back" (click)="goBack()" [disabled]="saving">
      <i class="bi bi-arrow-left me-2"></i>
      Back
    </button>

    <div class="ups-page-title">
      <h2 class="fw-bold text-primary mb-0">
        <i class="bi bi-diagram-3 me-2"></i>
        System Control Cabinet (SCC)
      </h2>
      <div class="text-dark mt-2">
        <span class="fw-semibold">Job ID: {{ callNbr || 'N/A' }} | Equipment No: {{ equipNo || 'N/A' }} | Equipment ID: {{ equipId || 'N/A' }}</span>
      </div>
    </div>

    <button type="button" class="btn btn-sm btn-primary ats-readings-header__action" (click)="saveSCC()" [disabled]="saving">
      <span *ngIf="saving" class="spinner-border spinner-border-sm me-2" role="status"></span>
      <i *ngIf="!saving" class="bi bi-check-circle me-2"></i>
      {{ saving ? 'Saving...' : 'Save SCC' }}
    </button>
  </div>

  <!-- Messages -->
  <div class="ats-readings-messages mb-3" *ngIf="errorMessage || successMessage">
    <div *ngIf="errorMessage" class="alert alert-danger d-inline-flex align-items-center">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      <span [innerHTML]="errorMessage"></span>
    </div>
    <div *ngIf="successMessage" class="alert alert-success d-inline-flex align-items-center">
      <i class="bi bi-check-circle-fill me-2"></i>
      <span>{{ successMessage }}</span>
    </div>
  </div>

  <!-- Main card wrapper -->
  <div class="card shadow-sm ats-main-card">
    <div class="card-body">
      <div class="ats-readings-form">

        <!-- Equipment Verification -->
        <section class="ats-readings-section mb-4">
          <div class="ats-section-card">
            <div class="ats-section-header" (click)="showEquipmentVerification = !showEquipmentVerification">
              <div class="ats-section-title">
                <i class="bi bi-gear-wide-connected me-2 text-primary"></i>
                <h5 class="mb-0">Equipment Verification</h5>
                <small class="text-muted">Verify SCC equipment details and specifications</small>
              </div>
              <i class="bi transition-transform" [class.bi-chevron-down]="showEquipmentVerification" [class.bi-chevron-right]="!showEquipmentVerification" [class.rotate-90]="showEquipmentVerification"></i>
            </div>
            <div class="ats-section-content" [class.show]="showEquipmentVerification">
              <form class="ats-form" [formGroup]="equipmentVerificationForm">
                <div class="form-group-modern">
                  <div class="row g-3">
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" formControlName="manufacturer" id="manufacturer" required>
                          <option value="" disabled>Select manufacturer</option>
                          <option *ngFor="let m of manufacturers" [value]="m.value">{{ m.label }}</option>
                        </select>
                        <label for="manufacturer">Make <span class="text-danger">*</span></label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="modelNo" id="modelNo" placeholder="Model No" required />
                        <label for="modelNo">Model No <span class="text-danger">*</span></label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="serialNo" id="serialNo" placeholder="Serial No" />
                        <label for="serialNo">Serial No</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="location" id="location" placeholder="Location" />
                        <label for="location">Location</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="date" class="form-control" formControlName="dateCode" id="dateCode" placeholder="Date Code" required />
                        <label for="dateCode">Date Code <span class="text-danger">*</span></label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="number" class="form-control" formControlName="temperature" id="temperature" placeholder="Temperature" required />
                        <label for="temperature">Temperature (Â°F) <span class="text-danger">*</span></label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" formControlName="status" id="status">
                          <option *ngFor="let option of statusOptions" [value]="option.value">{{ option.label }}</option>
                        </select>
                        <label for="status">Status</label>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="form-floating">
                        <textarea class="form-control" formControlName="statusNotes" id="statusNotes" 
                                  placeholder="Status Notes" style="height: 80px"></textarea>
                        <label for="statusNotes">Status Notes</label>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- Reconciliation Section (mirrors ATS Equipment Reconciliation design) -->
        <section class="ats-readings-section mb-4">
          <div class="ats-section-card">
            <div class="ats-section-header" (click)="showReconciliation = !showReconciliation">
              <div class="ats-section-title">
                <i class="bi bi-check2-square me-2 text-success"></i>
                <h5 class="mb-0">Equipment Reconciliation</h5>
                <small class="text-muted">Verify recorded information matches actual equipment</small>
              </div>
              <div class="d-flex align-items-center gap-3" [formGroup]="reconciliationForm" (click)="$event.stopPropagation()">
                <div class="verification-status">
                  <div class="form-check d-flex align-items-center">
                    <input type="checkbox" class="form-check-input" formControlName="verified" id="verifiedHeader" />
                    <label class="form-check-label fw-semibold" [class]="reconciliationForm.get('verified')?.value ? 'text-success' : 'text-muted'" for="verifiedHeader">
                      <i class="bi me-1" [class]="reconciliationForm.get('verified')?.value ? 'bi-check-circle-fill text-success' : 'bi-circle text-muted'"></i>
                      Verified
                    </label>
                  </div>
                </div>
                <i class="bi transition-transform" [class.bi-chevron-down]="showReconciliation" [class.bi-chevron-right]="!showReconciliation" [class.rotate-90]="showReconciliation"></i>
              </div>
            </div>

            <div class="ats-section-content" [class.show]="showReconciliation">
              <form [formGroup]="reconciliationForm" class="ats-form">
                <div class="form-group-modern">
                  <div class="row g-3">
                    <!-- Model row -->
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="recModel" [value]="reconciliationForm.get('recModel')?.value || ''" readonly id="recModel" placeholder="Model" style="color: #000 !important; opacity: 1 !important;" />
                        <label for="recModel">Model</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" formControlName="recModelCorrect" id="recModelCorrect">
                          <option *ngFor="let o of yesNoOptions" [value]="o.value">{{ o.label }}</option>
                        </select>
                        <label for="recModelCorrect">Is this Correct?</label>
                      </div>
                    </div>
                    <div class="col-md-5">
                      <div class="form-floating">
                        <input type="text" class="form-control text-danger" formControlName="actModel" [readonly]="reconciliationForm.get('recModelCorrect')?.value !== 'NO'" id="actModel" placeholder="Actual Model" />
                        <label for="actModel">Actual</label>
                      </div>
                    </div>

                    <!-- Serial No row -->
                    <div class="col-md-4">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="recSerialNo" [value]="reconciliationForm.get('recSerialNo')?.value || ''" readonly id="recSerialNo" placeholder="Serial No" style="color: #000 !important; opacity: 1 !important;" />
                        <label for="recSerialNo">Serial No</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <select class="form-select" formControlName="recSerialNoCorrect" id="recSerialNoCorrect">
                          <option *ngFor="let o of yesNoOptions" [value]="o.value">{{ o.label }}</option>
                        </select>
                        <label for="recSerialNoCorrect">Is this Correct?</label>
                      </div>
                    </div>
                    <div class="col-md-5">
                      <div class="form-floating">
                        <input type="text" class="form-control text-danger" formControlName="actSerialNo" [readonly]="reconciliationForm.get('recSerialNoCorrect')?.value !== 'NO'" id="actSerialNo" placeholder="Actual Serial No" />
                        <label for="actSerialNo">Actual</label>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- Voltage Settings -->
        <section class="ats-readings-section mb-4">
          <div class="ats-section-card">
            <div class="ats-section-header" (click)="showVoltageSettings = !showVoltageSettings">
              <div class="ats-section-title">
                <i class="bi bi-clock-history me-2 text-warning"></i>
                <h5 class="mb-0">Timers and Voltage Settings</h5>
                <small class="text-muted">Record voltage readings from display</small>
              </div>
              <i class="bi transition-transform" [class.bi-chevron-down]="showVoltageSettings" [class.bi-chevron-right]="!showVoltageSettings" [class.rotate-90]="showVoltageSettings"></i>
            </div>
            <div class="ats-section-content" [class.show]="showVoltageSettings">
              <form class="ats-form" [formGroup]="voltageSettingsForm">
                <div class="form-group-modern">
                  <!-- Bypass Voltages -->
                  <div class="row g-3 mb-2">
                    <div class="col-3">
                      <h6 class="fw-bold text-primary mt-3 mb-3">Bypass Voltages</h6>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="bypassVoltA" id="bypassVoltA" placeholder="A" />
                        <label for="bypassVoltA">A</label>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="bypassVoltB" id="bypassVoltB" placeholder="B" />
                        <label for="bypassVoltB">B</label>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="bypassVoltC" id="bypassVoltC" placeholder="C" />
                        <label for="bypassVoltC">C</label>
                      </div>
                    </div>
                  </div>

                  <!-- Power Supply Voltages -->
                  <div class="row g-3 mb-2">
                    <div class="col-3">
                      <h6 class="fw-bold text-primary mt-3 mb-3">Power Supply Voltages</h6>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="supplyVoltA" id="supplyVoltA" placeholder="A" />
                        <label for="supplyVoltA">A</label>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="supplyVoltB" id="supplyVoltB" placeholder="B" />
                        <label for="supplyVoltB">B</label>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="supplyVoltC" id="supplyVoltC" placeholder="C" />
                        <label for="supplyVoltC">C</label>
                      </div>
                    </div>
                  </div>

                  <!-- System Output Voltage -->
                  <div class="row g-3 mb-2">
                    <div class="col-3">
                      <h6 class="fw-bold text-primary mt-3 mb-3">System Output Voltage</h6>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="outputVoltA" id="outputVoltA" placeholder="A" />
                        <label for="outputVoltA">A</label>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="outputVoltB" id="outputVoltB" placeholder="B" />
                        <label for="outputVoltB">B</label>
                      </div>
                    </div>
                    <div class="col-md-1">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="outputVoltC" id="outputVoltC" placeholder="C" />
                        <label for="outputVoltC">C</label>
                      </div>
                    </div>
                  </div>

                  <!-- Additional Settings -->
                  <div class="row g-3 mt-1">
                    <div class="col-12">
                      <h6 class="fw-bold text-primary mb-2">Additional Settings</h6>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="firmwareVersion" id="firmwareVersion" placeholder="Firmware Version" />
                        <label for="firmwareVersion">System Firmware Version</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="phaseError" id="phaseError" placeholder="Phase Error" />
                        <label for="phaseError">Phase Error Degree Angle</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="partNos" id="partNos" placeholder="Part Numbers" />
                        <label for="partNos">SCC Part Number</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="form-floating">
                        <input type="text" class="form-control" formControlName="loadCurrent" id="loadCurrent" placeholder="Load Current" />
                        <label for="loadCurrent">System Load Current</label>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </section>

        <!-- Comments -->
        <section class="ats-readings-section mb-4">
          <div class="ats-section-card">
            <div class="ats-section-header" (click)="showComments = !showComments">
              <div class="ats-section-title">
                <i class="bi bi-chat-left-text me-2 text-primary"></i>
                <h5 class="mb-0">Comments</h5>
              </div>
              <i class="bi transition-transform" [class.bi-chevron-down]="showComments" [class.bi-chevron-right]="!showComments" [class.rotate-90]="showComments"></i>
            </div>
            <div class="ats-section-content" [class.show]="showComments">
              <form class="ats-form" [formGroup]="commentsForm">
                <div class="form-floating">
                  <textarea class="form-control" formControlName="comments" id="comments" 
                            placeholder="Comments" style="height: 100px"></textarea>
                  <label for="comments">Please note the reason, if any</label>
                </div>
              </form>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>
</div>
