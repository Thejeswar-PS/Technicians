<div class="container-fluid">
  <!-- Loading Spinner -->
  <div *ngIf="loading" class="d-flex justify-content-center align-items-center" style="height: 200px;">
    <div class="spinner-border text-primary" role="status">
      <span class="sr-only">Loading...</span>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading">
    <!-- Header -->
    <div class="card mb-4">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0">UPS Readings</h4>
          <button type="button" class="btn btn-outline-secondary" (click)="onGoBack()">
            <i class="fas fa-arrow-left"></i> Back to Equipment Details
          </button>
        </div>
      </div>
      <div class="card-body">
        <h6 class="text-muted">{{ getSummary() }}</h6>
      </div>
    </div>

    <!-- Error/Success Messages -->
    <div *ngIf="errorMessage" class="alert alert-danger mb-4">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="alert alert-success mb-4">
      {{ successMessage }}
    </div>

    <!-- Equipment Verification Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showReconciliation = !showReconciliation"
                  [attr.aria-expanded]="showReconciliation">
            <i class="fas" [class.fa-chevron-down]="showReconciliation" [class.fa-chevron-right]="!showReconciliation"></i>
            Equipment Verification
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showReconciliation">
        <div class="card-body">
          <form [formGroup]="equipmentForm">
            <div class="row">
              <div class="col-md-4">
                <label class="form-label">Manufacturer *</label>
                <select class="form-select" formControlName="manufacturer" 
                        [class.is-invalid]="equipmentForm.get('manufacturer')?.invalid && equipmentForm.get('manufacturer')?.touched">
                  <option value="">Please Select</option>
                  <option *ngFor="let mfg of manufacturers" [value]="mfg.value">{{ mfg.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">KVA *</label>
                <input type="text" class="form-control" formControlName="kva"
                       [class.is-invalid]="equipmentForm.get('kva')?.invalid && equipmentForm.get('kva')?.touched">
              </div>
              <div class="col-md-4">
                <label class="form-label">Multi-Module</label>
                <select class="form-select" formControlName="multiModule">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-4">
                <label class="form-label">Maintenance Bypass</label>
                <select class="form-select" formControlName="maintByPass">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Model *</label>
                <input type="text" class="form-control" formControlName="model"
                       [class.is-invalid]="equipmentForm.get('model')?.invalid && equipmentForm.get('model')?.touched">
              </div>
              <div class="col-md-4">
                <label class="form-label">Serial No *</label>
                <input type="text" class="form-control" formControlName="serialNo"
                       [class.is-invalid]="equipmentForm.get('serialNo')?.invalid && equipmentForm.get('serialNo')?.touched">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-4">
                <label class="form-label">Location *</label>
                <input type="text" class="form-control" formControlName="location"
                       [class.is-invalid]="equipmentForm.get('location')?.invalid && equipmentForm.get('location')?.touched">
              </div>
              <div class="col-md-4">
                <label class="form-label">Date Code *</label>
                <input type="date" class="form-control" formControlName="dateCode"
                       [class.is-invalid]="equipmentForm.get('dateCode')?.invalid && equipmentForm.get('dateCode')?.touched">
              </div>
              <div class="col-md-4">
                <label class="form-label">Status *</label>
                <select class="form-select" formControlName="status">
                  <option *ngFor="let status of statusOptions" [value]="status.value">{{ status.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-4">
                <label class="form-label">Parallel Cabinet</label>
                <select class="form-select" formControlName="parallelCabinet">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">SNMP Present</label>
                <select class="form-select" formControlName="snmpPresent">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Modular UPS</label>
                <select class="form-select" formControlName="modularUPS">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-6">
                <label class="form-label">Other</label>
                <input type="text" class="form-control" formControlName="other">
              </div>
              <div class="col-md-6">
                <label class="form-label">Status Notes</label>
                <textarea class="form-control" formControlName="statusNotes" rows="2"></textarea>
              </div>
            </div>
          </form>

          <!-- Equipment Reconciliation -->
          <hr class="my-4">
          <h6>Equipment Reconciliation</h6>
          <form [formGroup]="reconciliationForm">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">Model</label>
                <input type="text" class="form-control" formControlName="model">
              </div>
              <div class="col-md-3">
                <label class="form-label">Model Correct</label>
                <select class="form-select" formControlName="modelCorrect">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Actual Model</label>
                <input type="text" class="form-control" formControlName="actModel">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">Serial No</label>
                <input type="text" class="form-control" formControlName="serialNo">
              </div>
              <div class="col-md-3">
                <label class="form-label">Serial No Correct</label>
                <select class="form-select" formControlName="serialNoCorrect">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Actual Serial No</label>
                <input type="text" class="form-control" formControlName="actSerialNo">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">KVA Size</label>
                <input type="text" class="form-control" formControlName="kvaSize">
              </div>
              <div class="col-md-3">
                <label class="form-label">KVA Correct</label>
                <select class="form-select" formControlName="kvaCorrect">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Actual KVA</label>
                <input type="text" class="form-control" formControlName="actKVA">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">Total Equipment</label>
                <input type="text" class="form-control" formControlName="totalEquips">
              </div>
              <div class="col-md-3">
                <label class="form-label">Total Equipment Correct</label>
                <select class="form-select" formControlName="totalEquipsCorrect">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Actual Total Equipment</label>
                <input type="text" class="form-control" formControlName="actTotalEquips">
              </div>
              <div class="col-md-2">
                <div class="form-check mt-4">
                  <input type="checkbox" class="form-check-input" formControlName="verified" id="verified">
                  <label class="form-check-label" for="verified">Verified</label>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Measurements Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showMeasurements = !showMeasurements"
                  [attr.aria-expanded]="showMeasurements">
            <i class="fas" [class.fa-chevron-down]="showMeasurements" [class.fa-chevron-right]="!showMeasurements"></i>
            Measurements
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showMeasurements">
        <div class="card-body">
          <form [formGroup]="measurementsForm">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">Input Power</label>
                <select class="form-select" formControlName="inputPower">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">LCD</label>
                <select class="form-select" formControlName="lcd">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Load KVA</label>
                <select class="form-select" formControlName="loadKVA">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">3 Phase</label>
                <select class="form-select" formControlName="threePhase">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">Normal</label>
                <select class="form-select" formControlName="normal">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Calibration</label>
                <select class="form-select" formControlName="caliberation">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">End of Life</label>
                <select class="form-select" formControlName="endOfLife">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Visual/Mechanical Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showVisual = !showVisual"
                  [attr.aria-expanded]="showVisual">
            <i class="fas" [class.fa-chevron-down]="showVisual" [class.fa-chevron-right]="!showVisual"></i>
            Visual/Mechanical
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showVisual">
        <div class="card-body">
          <form [formGroup]="visualForm">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">No Alarms</label>
                <select class="form-select" formControlName="noAlarms">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Tightness</label>
                <select class="form-select" formControlName="tightness">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Broken</label>
                <select class="form-select" formControlName="broken">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Vacuum</label>
                <select class="form-select" formControlName="vacuum">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">EPO</label>
                <select class="form-select" formControlName="epo">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Noise</label>
                <select class="form-select" formControlName="noise">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Fans Age</label>
                <select class="form-select" formControlName="fansAge">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Replace Filters</label>
                <select class="form-select" formControlName="replaceFilters">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Environment Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showEnvironment = !showEnvironment"
                  [attr.aria-expanded]="showEnvironment">
            <i class="fas" [class.fa-chevron-down]="showEnvironment" [class.fa-chevron-right]="!showEnvironment"></i>
            Environment
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showEnvironment">
        <div class="card-body">
          <form [formGroup]="environmentForm">
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">Room Temperature</label>
                <select class="form-select" formControlName="roomTemp">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Safety</label>
                <select class="form-select" formControlName="safety">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Clean</label>
                <select class="form-select" formControlName="clean">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-3">
                <label class="form-label">Space</label>
                <select class="form-select" formControlName="space">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">Circuit</label>
                <select class="form-select" formControlName="circuit">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Input Power Readings Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showInputReadings = !showInputReadings"
                  [attr.aria-expanded]="showInputReadings">
            <i class="fas" [class.fa-chevron-down]="showInputReadings" [class.fa-chevron-right]="!showInputReadings"></i>
            Input Power Readings
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showInputReadings">
        <div class="card-body">
          <form [formGroup]="inputReadingsForm">
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">Voltage Configuration</label>
                <select class="form-select" formControlName="configuration" 
                        (change)="onVoltageConfigurationChange('input', $any($event.target).value)">
                  <option *ngFor="let config of voltageConfigurations" [value]="config.id">{{ config.name }}</option>
                </select>
              </div>
            </div>

            <!-- Dynamic voltage fields based on configuration -->
            <div *ngIf="inputConfig">
              <!-- Single Phase Configuration -->
              <div *ngIf="inputConfig.phaseCount === 1" class="row">
                <div class="col-md-2">
                  <label class="form-label">Voltage A</label>
                  <input type="number" class="form-control" formControlName="voltA" step="0.01">
                </div>
                <div class="col-md-2">
                  <select class="form-select" formControlName="voltA_PF">
                    <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <label class="form-label">Current A</label>
                  <input type="number" class="form-control" formControlName="currA" step="0.01">
                </div>
                <div class="col-md-2">
                  <select class="form-select" formControlName="currA_PF">
                    <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                  </select>
                </div>
                <div class="col-md-2">
                  <label class="form-label">Frequency</label>
                  <input type="number" class="form-control" formControlName="freq" step="0.01">
                </div>
                <div class="col-md-2">
                  <select class="form-select" formControlName="freq_PF">
                    <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                  </select>
                </div>
              </div>

              <!-- Two Phase Configuration -->
              <div *ngIf="inputConfig.phaseCount === 2">
                <div class="row">
                  <div class="col-md-2">
                    <label class="form-label">Voltage A</label>
                    <input type="number" class="form-control" formControlName="voltA" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="voltA_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Current A</label>
                    <input type="number" class="form-control" formControlName="currA" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="currA_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Frequency</label>
                    <input type="number" class="form-control" formControlName="freq" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="freq_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-md-2">
                    <label class="form-label">Voltage B</label>
                    <input type="number" class="form-control" formControlName="voltB" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="voltB_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Current B</label>
                    <input type="number" class="form-control" formControlName="currB" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="currB_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- Three Phase Configuration -->
              <div *ngIf="inputConfig.phaseCount === 3">
                <div class="row">
                  <div class="col-md-2">
                    <label class="form-label">Voltage A to B</label>
                    <input type="number" class="form-control" formControlName="voltA" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="voltA_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Current A</label>
                    <input type="number" class="form-control" formControlName="currA" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="currA_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Frequency</label>
                    <input type="number" class="form-control" formControlName="freq" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="freq_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-md-2">
                    <label class="form-label">Voltage B to C</label>
                    <input type="number" class="form-control" formControlName="voltB" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="voltB_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Current B</label>
                    <input type="number" class="form-control" formControlName="currB" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="currB_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                  <div class="col-md-2">
                    <label class="form-label">Voltage C to A</label>
                    <input type="number" class="form-control" formControlName="voltC" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="voltC_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-md-2">
                    <label class="form-label">Current C</label>
                    <input type="number" class="form-control" formControlName="currC" step="0.01">
                  </div>
                  <div class="col-md-2">
                    <select class="form-select" formControlName="currC_PF">
                      <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                    </select>
                  </div>
                </div>

                <!-- Phase to Neutral calculations for applicable configurations -->
                <div *ngIf="shouldShowPhaseToNeutral(inputConfig)" class="row mt-3">
                  <div class="col-12">
                    <h6 class="text-muted">Phase to Neutral Voltages (Calculated)</h6>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">A to N</label>
                    <input type="text" class="form-control" 
                           [value]="getPhaseToNeutralVoltage(inputReadingsForm.get('voltA')?.value)" 
                           readonly>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">B to N</label>
                    <input type="text" class="form-control" 
                           [value]="getPhaseToNeutralVoltage(inputReadingsForm.get('voltB')?.value)" 
                           readonly>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label">C to N</label>
                    <input type="text" class="form-control" 
                           [value]="getPhaseToNeutralVoltage(inputReadingsForm.get('voltC')?.value)" 
                           readonly>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bypass Power Readings Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showBypassReadings = !showBypassReadings"
                  [attr.aria-expanded]="showBypassReadings">
            <i class="fas" [class.fa-chevron-down]="showBypassReadings" [class.fa-chevron-right]="!showBypassReadings"></i>
            Bypass Power Readings
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showBypassReadings">
        <div class="card-body">
          <form [formGroup]="bypassReadingsForm">
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">Voltage Configuration</label>
                <select class="form-select" formControlName="configuration" 
                        (change)="onVoltageConfigurationChange('bypass', $any($event.target).value)">
                  <option *ngFor="let config of voltageConfigurations" [value]="config.id">{{ config.name }}</option>
                </select>
              </div>
            </div>

            <!-- Similar voltage configuration structure as Input readings -->
            <!-- (Implementation similar to Input section above) -->
            
          </form>
        </div>
      </div>
    </div>

    <!-- Output Power Readings Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showOutputReadings = !showOutputReadings"
                  [attr.aria-expanded]="showOutputReadings">
            <i class="fas" [class.fa-chevron-down]="showOutputReadings" [class.fa-chevron-right]="!showOutputReadings"></i>
            Output Power Readings
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showOutputReadings">
        <div class="card-body">
          <form [formGroup]="outputReadingsForm">
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">Voltage Configuration</label>
                <select class="form-select" formControlName="configuration" 
                        (change)="onVoltageConfigurationChange('output', $any($event.target).value)">
                  <option *ngFor="let config of voltageConfigurations" [value]="config.id">{{ config.name }}</option>
                </select>
              </div>
            </div>

            <!-- Similar voltage configuration structure as Input readings, plus Load fields -->
            <!-- (Implementation similar to Input section above, with additional Load fields) -->
            
          </form>
        </div>
      </div>
    </div>

    <!-- Rectifier Readings Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showRectifier = !showRectifier"
                  [attr.aria-expanded]="showRectifier">
            <i class="fas" [class.fa-chevron-down]="showRectifier" [class.fa-chevron-right]="!showRectifier"></i>
            Rectifier Readings
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showRectifier">
        <div class="card-body">
          <form [formGroup]="rectifierForm">
            <div class="row">
              <div class="col-md-2">
                <label class="form-label">Float Voltage</label>
                <select class="form-select" formControlName="floatVolt_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">DC Voltage</label>
                <input type="number" class="form-control" formControlName="dcVoltage" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="dcVoltage_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Ripple %</label>
                <input type="number" class="form-control" formControlName="acRipple" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="acRipple_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-2">
                <label class="form-label">DC Current</label>
                <input type="number" class="form-control" formControlName="dcCurrent" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="dcCurrent_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Ripple Volt</label>
                <input type="number" class="form-control" formControlName="acRippleVolt" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="acRippleVolt_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Pos to GND</label>
                <input type="number" class="form-control" formControlName="posToGND" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="posToGND_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-2">
                <label class="form-label">AC Ripple Curr</label>
                <input type="number" class="form-control" formControlName="acRippleCurr" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="acRippleCurr_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Neg to GND</label>
                <input type="number" class="form-control" formControlName="negToGND" step="0.01">
              </div>
              <div class="col-md-2">
                <select class="form-select" formControlName="negToGND_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Capacitor Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showCapacitor = !showCapacitor"
                  [attr.aria-expanded]="showCapacitor">
            <i class="fas" [class.fa-chevron-down]="showCapacitor" [class.fa-chevron-right]="!showCapacitor"></i>
            Capacitor Readings
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showCapacitor">
        <div class="card-body">
          <form [formGroup]="capacitorForm">
            <div class="row">
              <div class="col-md-2">
                <label class="form-label">DC Caps Leak</label>
                <select class="form-select" formControlName="dcCaps_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">DC Caps Age</label>
                <select class="form-select" formControlName="dcCapsAge_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">DC Caps Year</label>
                <input type="number" class="form-control" formControlName="dcCapsAge">
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Input Caps Leak</label>
                <select class="form-select" formControlName="acInputCaps_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Input Caps Age</label>
                <select class="form-select" formControlName="acInputCapsAge_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Input Year</label>
                <input type="number" class="form-control" formControlName="acInputCapsAge">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-2">
                <label class="form-label">AC Output Caps Leak</label>
                <select class="form-select" formControlName="acOutputCaps_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Output Caps Age</label>
                <select class="form-select" formControlName="acOutputCapsAge_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">AC Output Year</label>
                <input type="number" class="form-control" formControlName="acOutputCapsAge">
              </div>
              <div class="col-md-2">
                <label class="form-label">Comm Caps Leak</label>
                <select class="form-select" formControlName="commCaps_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Comm Caps Age</label>
                <select class="form-select" formControlName="commCapsAge_PF">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Comm Year</label>
                <input type="number" class="form-control" formControlName="commCapsAge">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-4">
                <label class="form-label">Fans Year</label>
                <input type="number" class="form-control" formControlName="fansYear">
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Transfer Test Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showTransfer = !showTransfer"
                  [attr.aria-expanded]="showTransfer">
            <i class="fas" [class.fa-chevron-down]="showTransfer" [class.fa-chevron-right]="!showTransfer"></i>
            Transfer Test
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showTransfer">
        <div class="card-body">
          <form [formGroup]="transferForm">
            <div class="row">
              <div class="col-md-4">
                <label class="form-label">First Major (if applicable)</label>
                <select class="form-select" formControlName="firstMajor">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Static Bypass</label>
                <select class="form-select" formControlName="staticBypass">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Transfer Maint Bypass</label>
                <select class="form-select" formControlName="transMaintByPass">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-4">
                <label class="form-label">Current Wave</label>
                <select class="form-select" formControlName="currentWave">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Normal Mode</label>
                <select class="form-select" formControlName="normalMode">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Verify Alarm</label>
                <select class="form-select" formControlName="verifyAlarm">
                  <option *ngFor="let option of passfailOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Action Items Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showActions = !showActions"
                  [attr.aria-expanded]="showActions">
            <i class="fas" [class.fa-chevron-down]="showActions" [class.fa-chevron-right]="!showActions"></i>
            Action Items
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showActions">
        <div class="card-body">
          <form [formGroup]="actionForm">
            <div class="row">
              <div class="col-md-6">
                <label class="form-label">DCG Action Required</label>
                <select class="form-select" formControlName="dcgAction1">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Customer Action Required</label>
                <select class="form-select" formControlName="custAction1">
                  <option *ngFor="let option of yesNoOptions" [value]="option.value">{{ option.text }}</option>
                </select>
              </div>
            </div>

            <!-- Air Filter Information -->
            <hr class="my-4">
            <h6>Air Filter Information</h6>
            <div class="row">
              <div class="col-md-3">
                <label class="form-label">Length</label>
                <input type="text" class="form-control" formControlName="airFilterLength">
              </div>
              <div class="col-md-3">
                <label class="form-label">Width</label>
                <input type="text" class="form-control" formControlName="airFilterWidth">
              </div>
              <div class="col-md-3">
                <label class="form-label">Thickness</label>
                <input type="text" class="form-control" formControlName="airFilterThick">
              </div>
              <div class="col-md-3">
                <label class="form-label">Quantity</label>
                <input type="text" class="form-control" formControlName="airFilterQty">
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-md-3">
                <label class="form-label">Length 1</label>
                <input type="text" class="form-control" formControlName="airFilterLength1">
              </div>
              <div class="col-md-3">
                <label class="form-label">Width 1</label>
                <input type="text" class="form-control" formControlName="airFilterWidth1">
              </div>
              <div class="col-md-3">
                <label class="form-label">Thickness 1</label>
                <input type="text" class="form-control" formControlName="airFilterThick1">
              </div>
              <div class="col-md-3">
                <label class="form-label">Quantity 1</label>
                <input type="text" class="form-control" formControlName="airFilterQty1">
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">
          <button class="btn btn-link text-decoration-none p-0 fw-bold" 
                  type="button" 
                  (click)="showComments = !showComments"
                  [attr.aria-expanded]="showComments">
            <i class="fas" [class.fa-chevron-down]="showComments" [class.fa-chevron-right]="!showComments"></i>
            Comments
          </button>
        </h5>
      </div>
      <div class="collapse" [class.show]="showComments">
        <div class="card-body">
          <form [formGroup]="commentsForm">
            <div class="row">
              <div class="col-12 mb-3">
                <label class="form-label">Comments 1</label>
                <textarea class="form-control" formControlName="comments1" rows="3"></textarea>
              </div>
              <div class="col-12 mb-3">
                <label class="form-label">Comments 2</label>
                <textarea class="form-control" formControlName="comments2" rows="3"></textarea>
              </div>
              <div class="col-12 mb-3">
                <label class="form-label">Comments 3</label>
                <textarea class="form-control" formControlName="comments3" rows="3"></textarea>
              </div>
              <div class="col-12 mb-3">
                <label class="form-label">Comments 4</label>
                <textarea class="form-control" formControlName="comments4" rows="3"></textarea>
              </div>
              <div class="col-12 mb-3">
                <label class="form-label">Comments 5</label>
                <textarea class="form-control" formControlName="comments5" rows="3"></textarea>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="card">
      <div class="card-body">
        <div class="d-flex gap-3">
          <button type="button" 
                  class="btn btn-primary" 
                  [disabled]="saving" 
                  (click)="onSave()">
            <span *ngIf="saving" class="spinner-border spinner-border-sm me-2" role="status"></span>
            <i *ngIf="!saving" class="fas fa-save me-2"></i>
            {{ saving ? 'Saving...' : 'Save' }}
          </button>
          
          <button type="button" 
                  class="btn btn-outline-secondary" 
                  [disabled]="saving" 
                  (click)="onSaveAsDraft()">
            <i class="fas fa-draft2digital me-2"></i>
            Save as Draft
          </button>
          
          <button type="button" 
                  class="btn btn-outline-danger" 
                  (click)="onGoBack()">
            <i class="fas fa-times me-2"></i>
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>