<div class="container-fluid order-request-status-container">

  <!-- Loading Overlay -->
  <div *ngIf="isLoading"
       class="position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center loading-overlay">
    <div class="spinner-border text-primary"></div>
  </div>

  <div class="card shadow-sm main-card">

    <!-- Header -->
    <div class="card-header border-0 py-4 text-center">
      <h3 class="fw-bold text-primary mb-0">
        <i class="bi bi-clipboard-check me-2"></i>
        Order Request Status
      </h3>
    </div>

    <div class="card-body">

      <!-- Error -->
      <div *ngIf="errorMessage" class="alert alert-danger mb-3">
        <i class="bi bi-exclamation-triangle-fill me-2"></i>
        {{ errorMessage }}
      </div>

      <!-- Filters -->
      <div class="row filter-panel mb-3">
        <form class="row g-3 w-100" [formGroup]="orderStatusFilterForm">

          <div class="col-md-4">
            <label class="form-label fw-bold">Status</label>
            <select class="form-select" formControlName="status">
              <option *ngFor="let option of statusOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label fw-bold">Order Type</label>
            <select class="form-select" formControlName="orderType">
              <option *ngFor="let option of orderTypeOptions" [value]="option.value">
                {{ option.label }}
              </option>
            </select>
          </div>

          <div class="col-md-4 d-flex align-items-end">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" formControlName="archive">
              <label class="form-check-label fw-bold ms-2">
                Include Archived
              </label>
            </div>
          </div>

        </form>
      </div>

      <!-- Records per page -->
      <div class="d-flex justify-content-between align-items-center mb-2 px-1">

        <div class="d-flex align-items-center gap-2">
          <label class="fw-bold mb-0">Records per page:</label>
          <select class="form-select form-select-sm w-auto"
                  [(ngModel)]="itemsPerPage"
                  (change)="currentPage = 1">
            <option *ngFor="let size of pageSizeOptions" [value]="size">
              {{ size }}
            </option>
          </select>
        </div>

        <div class="text-muted fw-semibold">
          Showing {{ (currentPage - 1) * itemsPerPage + 1 }}
          –
          {{ Math.min(currentPage * itemsPerPage, totalItems) }}
          of {{ totalItems }}
        </div>

      </div>

      <!-- Table -->
      <div class="table-responsive">
        <table class="table table-hover table-bordered mb-0">

          <!-- =======================
               TABLE HEADER (SORTABLE)
               ======================= -->
          <thead>
            <tr>

              <th class="sortable" (click)="sortData('rowIndex')">
                <span class="header-cell">
                  Row #
                  <span class="sort-icons" [class.active]="sortColumn === 'rowIndex'">
                    <i class="up" [class.on]="sortColumn === 'rowIndex' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'rowIndex' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('orderType')">
                <span class="header-cell">
                  Order Type
                  <span class="sort-icons" [class.active]="sortColumn === 'orderType'">
                    <i class="up" [class.on]="sortColumn === 'orderType' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'orderType' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('requester')">
                <span class="header-cell">
                  Requester
                  <span class="sort-icons" [class.active]="sortColumn === 'requester'">
                    <i class="up" [class.on]="sortColumn === 'requester' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'requester' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('dcgPartNo')">
                <span class="header-cell">
                  DCG Part #
                  <span class="sort-icons" [class.active]="sortColumn === 'dcgPartNo'">
                    <i class="up" [class.on]="sortColumn === 'dcgPartNo' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'dcgPartNo' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('manufPartNo')">
                <span class="header-cell">
                  Manuf Part #
                  <span class="sort-icons" [class.active]="sortColumn === 'manufPartNo'">
                    <i class="up" [class.on]="sortColumn === 'manufPartNo' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'manufPartNo' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable text-center" (click)="sortData('qtyNeeded')">
                <span class="header-cell">
                  Qty
                  <span class="sort-icons" [class.active]="sortColumn === 'qtyNeeded'">
                    <i class="up" [class.on]="sortColumn === 'qtyNeeded' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'qtyNeeded' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('vendor')">
                <span class="header-cell">
                  Vendor
                  <span class="sort-icons" [class.active]="sortColumn === 'vendor'">
                    <i class="up" [class.on]="sortColumn === 'vendor' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'vendor' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('poNumber')">
                <span class="header-cell">
                  PO Number
                  <span class="sort-icons" [class.active]="sortColumn === 'poNumber'">
                    <i class="up" [class.on]="sortColumn === 'poNumber' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'poNumber' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('orderDate')">
                <span class="header-cell">
                  Order Date
                  <span class="sort-icons" [class.active]="sortColumn === 'orderDate'">
                    <i class="up" [class.on]="sortColumn === 'orderDate' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'orderDate' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('arriveDate')">
                <span class="header-cell">
                  Arrive Date
                  <span class="sort-icons" [class.active]="sortColumn === 'arriveDate'">
                    <i class="up" [class.on]="sortColumn === 'arriveDate' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'arriveDate' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable text-center" (click)="sortData('status')">
                <span class="header-cell">
                  Status
                  <span class="sort-icons" [class.active]="sortColumn === 'status'">
                    <i class="up" [class.on]="sortColumn === 'status' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'status' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('createdOn')">
                <span class="header-cell">
                  Created On
                  <span class="sort-icons" [class.active]="sortColumn === 'createdOn'">
                    <i class="up" [class.on]="sortColumn === 'createdOn' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'createdOn' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

              <th class="sortable" (click)="sortData('createdBy')">
                <span class="header-cell">
                  Created By
                  <span class="sort-icons" [class.active]="sortColumn === 'createdBy'">
                    <i class="up" [class.on]="sortColumn === 'createdBy' && sortDirection === 'asc'"></i>
                    <i class="down" [class.on]="sortColumn === 'createdBy' && sortDirection === 'desc'"></i>
                  </span>
                </span>
              </th>

            </tr>
          </thead>

          <!-- =======================
               TABLE BODY
               ======================= -->
          <tbody>
            <tr *ngFor="let orderRequest of getPaginatedData(); trackBy: trackByRowIndex">

              <td class="text-center fw-bold">{{ orderRequest.rowIndex }}</td>

              <td class="text-primary fw-bold cursor-pointer"
                  (click)="viewOrderRequest(orderRequest)">
                {{ orderRequest.orderType || 'N/A' }}
              </td>

              <td>{{ orderRequest.requester || 'N/A' }}</td>
              <td>{{ orderRequest.dcgPartNo || 'N/A' }}</td>
              <td>{{ orderRequest.manufPartNo || 'N/A' }}</td>

              <td class="text-center">
                <span class="badge bg-success">{{ orderRequest.qtyNeeded || 0 }}</span>
              </td>

              <td>{{ orderRequest.vendor || 'N/A' }}</td>
              <td>{{ orderRequest.poNumber || 'N/A' }}</td>

              <td class="text-center">{{ formatDate(orderRequest.orderDate) }}</td>
              <td class="text-center">{{ formatDate(orderRequest.arriveDate) }}</td>

              <td class="text-center">
                <span class="status-pill"
                      [ngClass]="getStatusPillClass(orderRequest.status)">
                  {{ orderRequest.status || 'N/A' }}
                </span>
              </td>

              <td class="text-center">{{ formatDateTime(orderRequest.createdOn) }}</td>
              <td>{{ orderRequest.createdBy || 'N/A' }}</td>

            </tr>
          </tbody>

        </table>
      </div>

      <!-- Pagination -->
      <div *ngIf="getTotalPages() > 1"
           class="d-flex justify-content-between align-items-center mt-3">

        <div class="text-muted">
          Page {{ currentPage }} of {{ getTotalPages() }}
        </div>

        <ul class="pagination mb-0">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="goToPage(currentPage - 1)">‹</button>
          </li>

          <li class="page-item"
              *ngFor="let page of getPageNumbers()"
              [class.active]="page === currentPage">
            <button class="page-link" (click)="goToPage(page)">
              {{ page }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
            <button class="page-link" (click)="goToPage(currentPage + 1)">›</button>
          </li>
        </ul>

      </div>

    </div>
  </div>
</div>
