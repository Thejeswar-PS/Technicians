<!-- Stripped Units Status Page -->
<div class="container-fluid stripped-units-status-container">

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-primary"></div>
  </div>

  <!-- PAGE HEADER -->
  <div class="card shadow-sm main-card mb-12">
    <div class="card-header border-0 py-16">
      <div class="position-relative d-flex align-items-center">
        <button
          class="btn btn-sm btn-primary position-absolute start-0"
          (click)="goBack()"
          [disabled]="isLoading">
          <i class="bi bi-arrow-left me-4"></i> Back
        </button>

        <h3 class="fw-bold text-primary mb-0 w-100 text-center">
          Stripped Units Status
        </h3>
      </div>
    </div>
  </div>

  <!-- =======================
       MAKE DISTRIBUTION (BAR)
       ======================= -->
  <div class="card shadow-sm main-card mb-16">
    <div class="card-header fw-semibold">
      Make Distribution
    </div>

    <div class="card-body">
      <div *ngIf="isLoadingMakeChart" class="text-center py-24">
        <div class="spinner-border text-primary"></div>
      </div>

      <div *ngIf="!isLoadingMakeChart && makeCountsList.length > 0">
        <apx-chart
          [series]="barChartOptions.series"
          [chart]="barChartOptions.chart"
          [plotOptions]="barChartOptions.plotOptions"
          [dataLabels]="barChartOptions.dataLabels"
          [xaxis]="barChartOptions.xaxis"
          [yaxis]="barChartOptions.yaxis"
          [colors]="barChartOptions.colors"
          [tooltip]="barChartOptions.tooltip"
          [grid]="barChartOptions.grid"
          [states]="barChartOptions.states">
        </apx-chart>
      </div>
    </div>
  </div>

  <!-- FILTER PANEL -->
  <div class="filter-panel mb-16" [formGroup]="filterForm">
    <div class="row g-12">
      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select class="form-select"
                formControlName="status"
                (change)="onStatusChange()">
          <option *ngFor="let option of statusOptions"
                  [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- PAGINATION HEADER -->
  <div class="d-flex align-items-center justify-content-between mb-3" 
       *ngIf="!isLoading && filteredUnitsList.length > 0">
    
    <!-- LEFT: Records per page -->
    <div class="d-flex align-items-center">
      <label class="me-2 fw-semibold">Records per page:</label>
      <select class="form-select form-select-sm w-auto"
              [value]="itemsPerPage"
              (change)="changeItemsPerPage(+$any($event.target).value)">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>

    <!-- CENTER: Showing X - Y of Z records -->
    <div class="flex-fill text-center fw-semibold">
      Showing
      {{ totalItems ? ((currentPage - 1) * itemsPerPage + 1) : 0 }}
      -
      {{ totalItems ? Math.min(currentPage * itemsPerPage, totalItems) : 0 }}
      of {{ totalItems }} records
    </div>

    <!-- RIGHT: Prev, Page X of Y, Next -->
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-sm btn-outline-secondary" 
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
        Prev
      </button>
      <span class="fw-semibold">Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="btn btn-sm btn-outline-secondary" 
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-scroll-wrapper"
       *ngIf="!isLoading && paginatedItems.length > 0">

    <table class="table parts-status-table">
      <thead>
        <tr>
          <th class="sortable" (click)="sortBy('rowIndex')">Row <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('make')">Make <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('model')">Model <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('serialNo')">Serial <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('kva')">KVA <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('poNumber')">PO# <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('shippingPO')">Shipping PO <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('unitCost')">Unit Cost <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('shipCost')">Ship Cost <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('status')">Status <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('strippedBy')">Stripped By <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('putAwayBy')">Put Away By <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('createdOn')">Created On <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th>Add Parts</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of paginatedItems" 
            [className]="item.stripExists > 0 ? 'has-stripped-parts' : ''">
          <td class="text-center">{{ item.rowIndex }}</td>
          <td><a class="make-link">{{ item.make }}</a></td>
          <td>{{ item.model }}</td>
          <td class="wrap">{{ item.serialNo }}</td>
          <td class="text-center">{{ item.kva }}</td>
          <td class="wrap">{{ item.poNumber }}</td>
          <td class="wrap">{{ item.shippingPO }}</td>
          <td class="text-end">{{ item.unitCost | currency }}</td>
          <td class="text-end">{{ item.shipCost | currency }}</td>
          <td class="text-center">
            <span class="status-badge"
                  [ngClass]="{
                    'status-open': item.status === 'Open',
                    'status-inprogress': item.status === 'In Progress',
                    'status-completed': item.status === 'Completed',
                    'status-cancelled': item.status === 'Cancelled'
                  }">
              {{ item.status }}
            </span>
          </td>
          <td>{{ item.strippedBy }}</td>
          <td>{{ item.putAwayBy }}</td>
          <td>{{ formatDate(item.createdOn) }}</td>
          <td class="text-center">
            <button class="btn btn-primary btn-sm rounded-circle"><i class="bi bi-pencil-fill"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PAGINATION FOOTER -->
  <div class="d-flex align-items-center justify-content-between mt-16 pagination-footer"
       *ngIf="!isLoading && filteredUnitsList.length > 0 && totalPages > 1">
    
    <!-- LEFT: Previous button -->
    <div>
      <button class="btn btn-sm btn-outline-primary" 
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
        Previous
      </button>
    </div>

    <!-- CENTER: Page numbers -->
    <div class="d-flex align-items-center gap-2">
      <button *ngFor="let page of getVisiblePages()" 
              class="btn btn-sm"
              [class.btn-primary]="page === currentPage"
              [class.btn-outline-secondary]="page !== currentPage"
              (click)="goToPage(page)">
        {{ page }}
      </button>
    </div>

    <!-- RIGHT: Next button -->
    <div>
      <button class="btn btn-sm btn-outline-primary" 
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

</div>
