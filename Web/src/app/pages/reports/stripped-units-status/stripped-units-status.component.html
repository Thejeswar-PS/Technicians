<!-- Stripped Units Status Page -->
<div class="container-fluid stripped-units-status-container">

  <!-- Header Section -->
  <div class="order-request-header__top mb-2 d-flex justify-content-between align-items-center">
    
    <!-- Page Title - Centered -->
    <div class="order-request-page-title flex-grow-1 text-center">
      <h2 class="fw-bold text-primary mb-0">
        <i class="bi bi-clipboard-data me-2"></i>
        Stripped Units Status
      </h2>
    </div>
    
    <!-- Spacer for balance -->
    <div style="width: 80px;"></div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-primary"></div>
  </div>

  <!-- =======================
       MAKE DISTRIBUTION (BAR)
       ======================= -->
  <div class="vertical-bar-chart mb-4">
    <div *ngIf="isLoadingMakeChart" class="text-center py-24">
      <div class="spinner-border text-primary"></div>
    </div>

    <div *ngIf="!isLoadingMakeChart && makeCountsList.length > 0">
      <!-- Chart Header -->
      <div class="chart-header">
        <h6 class="chart-title">
          <i class="bi bi-bar-chart-fill me-2 text-primary"></i>
          Make Distribution
        </h6>
        <span class="chart-subtitle">Units by Make Type</span>
      </div>

      <!-- Chart Body -->
      <div class="chart-wrapper">

        <!-- Y Axis -->
        <div class="y-axis">
          <div class="y-label" *ngFor="let tick of getYAxisTicks()">
            {{ tick }}
          </div>
        </div>

        <!-- Bars Area -->
        <div class="bars-area">

          <div class="bar"
               *ngFor="let make of makeCountsList; let i = index"
               [style.height.%]="getBarHeightPercentage(make.makeCount)"
               [style.background]="getProgressColor(i)">

            <div class="bar-value">
              {{ make.makeCount }}
            </div>

          </div>

        </div>

      </div>

      <!-- X Axis Labels -->
      <div class="x-axis">
        <div class="x-label"
             *ngFor="let make of makeCountsList">
          {{ make.make }}
        </div>
      </div>
    </div>

    <div *ngIf="!isLoadingMakeChart && makeCountsList.length === 0" class="no-data-placeholder">
      <div class="no-data-content">
        <i class="bi bi-bar-chart display-1 mb-3 text-muted"></i>
        <h5 class="text-muted">No Make Data Available</h5>
        <p class="text-muted mb-0">Chart will appear when make data is loaded</p>
      </div>
    </div>
  </div>

  <!-- FILTER PANEL -->
  <div class="filter-panel mb-16" [formGroup]="filterForm">
    <div class="row g-12">
      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select class="form-select"
                formControlName="status"
                (change)="onStatusChange()">
          <option *ngFor="let option of statusOptions"
                  [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
    </div>
  </div>

  <!-- PAGINATION HEADER -->
  <div class="d-flex align-items-center justify-content-between mb-3" 
       *ngIf="!isLoading && filteredUnitsList.length > 0">
    
    <!-- LEFT: Records per page -->
    <div class="d-flex align-items-center">
      <label class="me-2 fw-semibold">Records per page:</label>
      <select class="form-select form-select-sm w-auto"
              [value]="itemsPerPage"
              (change)="changeItemsPerPage(+$any($event.target).value)">
        <option value="50">50</option>
        <option value="150">150</option>
        <option value="200">200</option>
        <option value="100">100</option>
      </select>
    </div>

    <!-- CENTER: Showing X - Y of Z records -->
    <div class="flex-fill text-center fw-semibold">
      Showing
      {{ totalItems ? ((currentPage - 1) * itemsPerPage + 1) : 0 }}
      -
      {{ totalItems ? Math.min(currentPage * itemsPerPage, totalItems) : 0 }}
      of {{ totalItems }} records
    </div>

    <!-- RIGHT: Prev, Page X of Y, Next -->
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-sm btn-outline-secondary" 
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
        Prev
      </button>
      <span class="fw-semibold">Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="btn btn-sm btn-outline-secondary" 
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-scroll-wrapper"
       *ngIf="!isLoading && paginatedItems.length > 0">

    <table class="table parts-status-table">
      <thead>
        <tr>
          <th class="sortable" (click)="sortBy('rowIndex')">Row <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('make')">Make <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('model')">Model <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('serialNo')">Serial <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('kva')">KVA <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('poNumber')">PO# <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('shippingPO')">Shipping PO <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('unitCost')">Unit Cost <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('shipCost')">Ship Cost <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('status')">Status <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('strippedBy')">Stripped By <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('putAwayBy')">Put Away By <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('createdOn')">Created On <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th>Add Parts</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of paginatedItems" 
            [className]="item.stripExists > 0 ? 'has-stripped-parts' : ''">
          <td class="text-center">{{ item.rowIndex }}</td>
          <td><a class="make-link" (click)="redirectToStrippedParts($event, item)" style="cursor: pointer; color: #007bff; text-decoration: none;">{{ item.make }}</a></td>
          <td>{{ item.model }}</td>
          <td class="wrap">{{ item.serialNo }}</td>
          <td class="text-center">{{ item.kva }}</td>
          <td class="wrap">{{ item.poNumber }}</td>
          <td class="wrap">{{ item.shippingPO }}</td>
          <td class="text-end">{{ item.unitCost | currency }}</td>
          <td class="text-end">{{ item.shipCost | currency }}</td>
          <td class="text-center">
            <span class="status-pill"
                  [ngClass]="{
                    'status-open': item.status === 'Open',
                    'status-inprogress': item.status === 'In Progress',
                    'status-completed': item.status === 'Completed',
                    'status-cancelled': item.status === 'Cancelled'
                  }">
              {{ item.status }}
            </span>
          </td>
          <td>{{ item.strippedBy }}</td>
          <td>{{ item.putAwayBy }}</td>
          <td>{{ formatDate(item.createdOn) }}</td>
          <td class="text-center">
            <button class="btn btn-primary btn-sm edit-btn"
                    style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;"
                    (click)="addParts(item)"
                    title="Add Parts">
              <i class="bi bi-pencil-square"></i>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!isLoading && filteredUnitsList.length === 0" class="no-data-placeholder">
    <div class="no-data-content">
      <i class="bi bi-inbox"></i>
      <h5>No Data Available</h5>
      <p>No data available for the selected filter.</p>
    </div>
  </div>

  <!-- PAGINATION FOOTER -->
  <div class="d-flex align-items-center justify-content-between mt-16 pagination-footer"
       *ngIf="!isLoading && filteredUnitsList.length > 0 && totalPages > 1">
    
    <!-- LEFT: Previous button -->
    <div>
      <button class="btn btn-sm btn-outline-primary" 
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
        Previous
      </button>
    </div>

    <!-- CENTER: Page numbers -->
    <div class="d-flex align-items-center gap-2">
      <button *ngFor="let page of getVisiblePages()" 
              class="btn btn-sm"
              [class.btn-primary]="page === currentPage"
              [class.btn-outline-secondary]="page !== currentPage"
              (click)="goToPage(page)">
        {{ page }}
      </button>
    </div>

    <!-- RIGHT: Next button -->
    <div>
      <button class="btn btn-sm btn-outline-primary" 
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

</div>
