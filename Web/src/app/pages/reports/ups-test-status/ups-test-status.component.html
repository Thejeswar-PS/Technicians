<!-- UPS Test Status Page -->
<div class="container-fluid ups-test-status-container">

  <!-- Header Section -->
  <div class="order-request-header__top mb-2 d-flex justify-content-between align-items-center">
    <!-- Back Button -->
    <button class="btn btn-outline-primary parts-request-header__back" (click)="goBack()" [disabled]="isLoading">
      <i class="bi bi-arrow-left me-2"></i>
      Back
    </button>
    
    <!-- Page Title - Centered -->
    <div class="order-request-page-title flex-grow-1 text-center">
      <h2 class="fw-bold text-primary mb-0">
        <i class="bi bi-activity me-2"></i>
        UPS Test Status
      </h2>
    </div>
    
    <!-- Spacer for balance -->
    <div style="width: 80px;"></div>
  </div>

  <!-- Loading Overlay -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="spinner-border text-primary"></div>
  </div>

  <!-- =======================
       MAKE DISTRIBUTION (BAR)
       ======================= -->
  <div class="vertical-bar-chart mb-4">
    <div *ngIf="isLoadingMakeChart" class="text-center py-24">
      <div class="spinner-border text-primary"></div>
    </div>

    <div *ngIf="!isLoadingMakeChart && makeCounts.length > 0">
      <!-- Chart Header -->
      <div class="chart-header">
        <h6 class="chart-title">
          <i class="bi bi-bar-chart-fill me-2 text-primary"></i>
          Make Distribution
        </h6>
        <span class="chart-subtitle">Units by Make Type</span>
      </div>

      <!-- Chart Body -->
      <div class="chart-wrapper">

        <!-- Y Axis -->
        <div class="y-axis">
          <div class="y-label" *ngFor="let tick of getYAxisTicks()">
            {{ tick }}
          </div>
        </div>

        <!-- Bars Area -->
        <div class="bars-area">

          <div class="bar"
               *ngFor="let make of makeCounts; let i = index"
               [style.height.%]="getBarHeightPercentage(make.makeCount)"
               [style.background]="getProgressColor(i)">

            <div class="bar-value">
              {{ make.makeCount }}
            </div>

          </div>

        </div>

      </div>

      <!-- X Axis Labels -->
      <div class="x-axis">
        <div class="x-label"
             *ngFor="let make of makeCounts">
          {{ make.make }}
        </div>
      </div>
    </div>

    <div *ngIf="!isLoadingMakeChart && makeCounts.length === 0" class="no-data-placeholder">
      <div class="no-data-content">
        <i class="bi bi-bar-chart display-1 mb-3 text-muted"></i>
        <h5 class="text-muted">No Make Data Available</h5>
        <p class="text-muted mb-0">Chart will appear when make data is loaded</p>
      </div>
    </div>
  </div>

  <!-- FILTER PANEL -->
  <div class="filter-panel mb-16" [formGroup]="filterForm">
    <div class="row g-12">
      <div class="col-md-3">
        <label class="form-label">Assigned To</label>
        <select class="form-select"
                formControlName="assignedTo"
                (change)="onStatusChange()">
          <option *ngFor="let option of technicianOptions"
                  [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Status</label>
        <select class="form-select"
                formControlName="status"
                (change)="onStatusChange()">
          <option *ngFor="let option of statusOptions"
                  [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Priority</label>
        <select class="form-select"
                formControlName="priority"
                (change)="onStatusChange()">
          <option *ngFor="let option of priorityOptions"
                  [value]="option.value">
            {{ option.label }}
          </option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Show</label>
        <div class="form-check form-switch">
          <input class="form-check-input"
                 type="checkbox"
                 id="archiveToggle"
                 formControlName="archive"
                 (change)="onStatusChange()">
          <label class="form-check-label" for="archiveToggle">Active</label>
        </div>
      </div>
    </div>
  </div>

  <!-- PAGINATION HEADER -->
  <div class="d-flex align-items-center justify-content-between mb-3" 
       *ngIf="!isLoading && filteredUnitsList.length > 0">
    
    <!-- LEFT: Records per page -->
    <div class="d-flex align-items-center">
      <label class="me-2 fw-semibold">Records per page:</label>
      <select class="form-select form-select-sm w-auto"
              [value]="itemsPerPage"
              (change)="changeItemsPerPage(+$any($event.target).value)">
        <option value="10">10</option>
        <option value="25">25</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>

    <!-- CENTER: Showing X - Y of Z records -->
    <div class="flex-fill text-center fw-semibold">
      Showing
      {{ totalItems ? ((currentPage - 1) * itemsPerPage + 1) : 0 }}
      -
      {{ totalItems ? Math.min(currentPage * itemsPerPage, totalItems) : 0 }}
      of {{ totalItems }} records
    </div>

    <!-- RIGHT: Prev, Page X of Y, Next -->
    <div class="d-flex align-items-center gap-2">
      <button class="btn btn-sm btn-outline-secondary" 
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
        Prev
      </button>
      <span class="fw-semibold">Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="btn btn-sm btn-outline-secondary" 
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-scroll-wrapper"
       *ngIf="!isLoading && paginatedItems.length > 0">

    <table class="table parts-status-table">
      <thead>
        <tr>
          <th class="sortable" (click)="sortBy('rowIndex')">No. <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('make')">Make <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('model')">Model <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('serialNo')">Serial No <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('poNumber')">PO # <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('shippingPO')">Shipping PO# <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('unitCost')">Unit Cost <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('shipCost')">Shipping Cost <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('status')">Status <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('priority')">Priority <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('assignedTo')">Assigned To <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('kva')">KVA <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
          <th class="sortable" (click)="sortBy('createdOn')">Created On <span class="sort-icon"><i class="bi bi-caret-up-fill"></i><i class="bi bi-caret-down-fill"></i></span></th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let item of paginatedItems">
          <td class="text-center">{{ item.rowIndex }}</td>
          <td>{{ item.make }}</td>
          <td>{{ item.model }}</td>
          <td class="wrap">{{ item.serialNo }}</td>
          <td class="wrap">{{ item.poNumber }}</td>
          <td class="wrap">{{ item.shippingPO }}</td>
          <td class="text-end">{{ formatCurrency(item.unitCost) }}</td>
          <td class="text-end">{{ formatCurrency(item.shipCost) }}</td>
          <td class="text-center">
            <span class="status-badge"
                  [ngClass]="{
                    'status-new': item.status === 'New',
                    'status-inprogress': item.status === 'In Progress',
                    'status-completed': item.status === 'Completed',
                    'status-failed': item.status === 'Failed'
                  }">
              {{ item.status }}
            </span>
          </td>
          <td class="text-center">
            <span class="priority-badge"
                  [ngClass]="{
                    'priority-high': item.priority === 'High',
                    'priority-medium': item.priority === 'Medium',
                    'priority-low': item.priority === 'Low'
                  }">
              {{ item.priority }}
            </span>
          </td>
          <td>{{ item.assignedTo }}</td>
          <td class="text-center">{{ item.kva }}</td>
          <td>{{ formatDate(item.createdOn) }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- PAGINATION FOOTER -->
  <div class="d-flex align-items-center justify-content-between mt-16 pagination-footer"
       *ngIf="!isLoading && filteredUnitsList.length > 0 && totalPages > 1">
    
    <!-- LEFT: Previous button -->
    <div>
      <button class="btn btn-sm btn-outline-primary" 
              [disabled]="currentPage <= 1"
              (click)="goToPage(currentPage - 1)">
        Previous
      </button>
    </div>

    <!-- CENTER: Page numbers -->
    <div class="d-flex align-items-center gap-2">
      <button *ngFor="let page of getVisiblePages()" 
              class="btn btn-sm"
              [class.btn-primary]="page === currentPage"
              [class.btn-outline-secondary]="page !== currentPage"
              (click)="goToPage(page)">
        {{ page }}
      </button>
    </div>

    <!-- RIGHT: Next button -->
    <div>
      <button class="btn btn-sm btn-outline-primary" 
              [disabled]="currentPage >= totalPages"
              (click)="goToPage(currentPage + 1)">
        Next
      </button>
    </div>
  </div>

  <!-- NO DATA MESSAGE -->
  <div *ngIf="!isLoading && paginatedItems.length === 0" 
       class="text-center py-5 no-data-message">
    <i class="bi bi-inbox display-1 text-muted"></i>
    <h4 class="text-muted mt-3">No UPS Units Found</h4>
    <p class="text-muted">No units match the current filter criteria.</p>
  </div>

</div>