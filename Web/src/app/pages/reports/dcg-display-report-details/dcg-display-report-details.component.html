<!-- DCG Display Report Details Page -->
<div class="container-fluid dcg-report-details-container">
  <!-- Loading spinner -->
  <div
    *ngIf="isLoading"
    class="d-flex justify-content-center align-items-center dcg-report-details-loading"
  >
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Header Section -->
  <div class="dcg-report-details-header__top mb-4 d-flex justify-content-between align-items-center">
    <button
      type="button"
      class="btn btn-sm btn-primary dcg-report-details-header__back"
      (click)="goBack()"
      [disabled]="isLoading"
    >
      <i class="bi bi-arrow-left me-2"></i>
      Back
    </button>
    
    <!-- Page Title - Centered -->
    <div class="dcg-report-details-page-title">
      <h2 class="fw-bold text-primary mb-0">
        <i class="bi bi-file-earmark-text me-2"></i>
        {{ reportTitle }}
      </h2>
      <div class="text-dark mt-2" *ngIf="!isLoading && totalRecords > 0">
        <span class="fw-semibold">{{ filteredData.length }} of {{ totalRecords }} records</span>
      </div>
    </div>

    <!-- Export Button -->
    <button 
      type="button" 
      class="btn btn-sm btn-light-primary"
      (click)="exportToCSV()"
      [disabled]="filteredData.length === 0 || isLoading">
      <i class="bi bi-download me-2"></i>
      Export CSV
    </button>
  </div>

  <!-- Main content -->
  <div *ngIf="!isLoading">
    <!-- Filter & Data Section -->
    <div class="card shadow-sm dcg-report-details-main-card">
      <!-- Filter Header -->
      <div class="card-header border-0 py-4">
        <div class="dcg-report-details-filter-header">
          <div class="row align-items-center mb-3">
            <div class="col">
              <h5 class="mb-0 fw-bold text-dark">
                <i class="bi bi-funnel me-2 text-primary"></i>
                Search & Filter
                <span class="badge ms-2" [ngClass]="getFilterBadgeClass()">
                  {{filteredData.length}} Result{{filteredData.length === 1 ? '' : 's'}}
                </span>
                <span *ngIf="reportType" class="badge badge-light-info ms-2">{{ reportType }}</span>
              </h5>
            </div>
            <div class="col-auto">
              <div class="d-inline-flex align-items-center">
                <label class="filter-label me-2 mb-0">
                  <i class="bi bi-eye me-1"></i>
                  Show Entries
                </label>
                <select 
                  class="form-select modern-select"
                  style="width: auto; min-width: 120px;"
                  [ngModel]="pageSize"
                  (ngModelChange)="changePageSize($event)">
                  <option [value]="10">10 entries</option>
                  <option [value]="25">25 entries</option>
                  <option [value]="50">50 entries</option>
                  <option [value]="100">100 entries</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Search and Summary Row -->
          <div class="row align-items-center">
            <!-- Search Input -->
            <div class="col-md-6">
              <div class="position-relative">
                <i class="bi bi-search position-absolute top-50 translate-middle-y ms-3 text-muted fs-6"></i>
                <input
                  type="text"
                  class="form-control ps-10"
                  placeholder="Search records..."
                  [(ngModel)]="searchTerm"
                  (input)="onSearch()"
                >
                <button
                  *ngIf="searchTerm"
                  type="button"
                  class="btn btn-icon btn-clear position-absolute top-50 end-0 translate-middle-y me-2"
                  (click)="clearSearch()"
                >
                  <i class="bi bi-x fs-6"></i>
                </button>
              </div>
            </div>
            
            <!-- Summary Information -->
            <div class="col-md-6" *ngIf="totalData !== null && totalData !== undefined">
              <div class="text-end">
                <div class="fw-bold text-primary fs-4">
                  Total Amount: {{ totalData | currency }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Table -->
      <div class="card-body p-0" *ngIf="!error && filteredData.length > 0">
        <div class="table-responsive">
          <table class="table table-row-bordered table-row-gray-100 align-middle gs-0 gy-3">
            <thead>
              <tr class="fw-bold text-muted">
                <th 
                  *ngFor="let key of getDataKeys()" 
                  class="text-dark fw-bold cursor-pointer"
                  (click)="sortBy(key)">
                  <div class="d-flex align-items-center">
                    {{ formatFieldName(key) }}
                    <i class="bi bi-arrow-up-down ms-1 fs-7 text-muted"></i>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of getPaginatedData(); trackBy: trackByFn; index as i">
                <td *ngFor="let key of getDataKeys()" class="text-gray-600">
                  <div class="fw-semibold" 
                       [class.text-primary]="key.toLowerCase().includes('amount')"
                       [class.text-success]="key.toLowerCase().includes('status') && formatFieldValue(item[key]).toLowerCase().includes('complete')"
                       [class.text-warning]="key.toLowerCase().includes('status') && formatFieldValue(item[key]).toLowerCase().includes('pending')"
                       [class.text-danger]="key.toLowerCase().includes('status') && formatFieldValue(item[key]).toLowerCase().includes('expired')">
                    {{ formatFieldValue(item[key]) }}
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="d-flex flex-stack flex-wrap p-6 border-top" *ngIf="getTotalPages() > 1">
          <div class="fs-6 fw-semibold text-gray-700">
            Showing {{ (currentPage - 1) * pageSize + 1 }} to 
            {{ Math.min(currentPage * pageSize, filteredData.length) }} 
            of {{ filteredData.length }} entries
          </div>
          
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPage === 1">
              <a class="page-link" (click)="goToPage(currentPage - 1)">
                <i class="previous"></i>
              </a>
            </li>
            
            <li 
              *ngFor="let page of getPaginationPages()" 
              class="page-item" 
              [class.active]="page === currentPage">
              <a class="page-link" (click)="goToPage(+page)" *ngIf="page !== '...'">{{ page }}</a>
              <span class="page-link" *ngIf="page === '...'">...</span>
            </li>
            
            <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
              <a class="page-link" (click)="goToPage(currentPage + 1)">
                <i class="next"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="card mt-5">
    <div class="card-body text-center py-10">
      <i class="bi bi-exclamation-triangle fs-2x text-warning mb-3"></i>
      <div class="text-danger fw-bold fs-4 mb-3">{{ error }}</div>
      <div class="text-muted">Please try refreshing the page or contact support if the issue persists.</div>
    </div>
  </div>

  <!-- No Data State -->
  <div *ngIf="!isLoading && !error && filteredData.length === 0 && reportData.length === 0" class="card mt-5">
    <div class="card-body text-center py-10">
      <i class="bi bi-file-earmark fs-2x text-muted mb-3"></i>
      <div class="text-muted fw-bold fs-4 mb-3">No data available</div>
      <div class="text-muted">There are no records to display for this report.</div>
    </div>
  </div>

  <!-- No Results from Search -->
  <div *ngIf="!isLoading && !error && filteredData.length === 0 && reportData.length > 0" class="card mt-5">
    <div class="card-body text-center py-10">
      <i class="bi bi-search fs-2x text-muted mb-3"></i>
      <div class="text-muted fw-bold fs-4 mb-3">No matching records found</div>
      <div class="text-muted mb-3">Try adjusting your search criteria</div>
      <button type="button" class="btn btn-light-primary" (click)="clearSearch()">
        Clear Search
      </button>
    </div>
  </div>
</div>