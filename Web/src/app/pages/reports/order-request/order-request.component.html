<!-- Order Request Page -->
<div class="container-fluid order-request-container">

  <!-- Loading spinner -->
  <div
    *ngIf="isLoading"
    class="d-flex justify-content-center align-items-center order-request-loading"
  >
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Header Section -->
  <div class="order-request-header__top mb-4 d-flex justify-content-between align-items-center">
    <button
      type="button"
      class="btn btn-sm btn-primary order-request-header__back"
      (click)="goBack()"
      [disabled]="isLoading">
      <i class="bi bi-arrow-left me-2"></i>
      Back
    </button>
    
    <!-- Page Title - Centered -->
    <div class="order-request-page-title">
      <h2 class="fw-bold text-primary mb-0">
        <i class="bi bi-clipboard-plus me-2"></i>
        Order Request
      </h2>
    </div>
    
    <!-- Auto Generated ID Badge -->
    <div class="id-badge-compact" *ngIf="!isLoading && autoGeneratedId">
      <small class="text-danger fw-bold">
        <i class="bi bi-hash me-1"></i>ID:
      </small>
      <span class="id-value">{{ autoGeneratedId.year }}-{{ autoGeneratedId.month }}-{{ autoGeneratedId.day }}-{{ autoGeneratedId.id }}</span>
    </div>
  </div>

  <!-- Main content -->
  <div *ngIf="!isLoading">

    <!-- Order Request Form Section -->
    <div class="card shadow-sm order-main-card">
      
      <!-- Status Messages -->
      <div class="message-section" *ngIf="formSuccess || formError">
        <!-- SUCCESS -->
        <div *ngIf="formSuccess && !isFormSubmitting" class="modern-alert success">
          <div class="alert-icon">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <div class="alert-content">
            <span class="alert-message">{{ formSuccess }}</span>
          </div>
        </div>

        <!-- ERROR -->
        <div *ngIf="formError && !isFormSubmitting" class="modern-alert error">
          <div class="alert-icon">
            <i class="bi bi-exclamation-triangle-fill"></i>
          </div>
          <div class="alert-content">
            <span class="alert-message">{{ formError }}</span>
          </div>
        </div>
      </div>
      <!-- Form Content -->
      <div class="form-content">
        
        <!-- Loading indicator -->
        <div *ngIf="isFormSubmitting" class="loading-overlay">
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <span class="loading-text">Saving order request...</span>
          </div>
        </div>

        <!-- Order Request Form -->
        <div class="form-wrapper" *ngIf="!isFormSubmitting">
          <form [formGroup]="orderRequestForm"
                class="modern-form"
                novalidate="novalidate"
                (ngSubmit)="saveOrderRequest()">

            <!-- Form Grid -->
            <div class="form-grid">

              <!-- Department -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-building field-icon"></i>
                    <span>Department</span>
                    <span class="required-indicator">*</span>
                  </label>
                </div>
                <div class="field-input">
                  <select class="modern-select"
                          formControlName="orderType"
                          [class.error]="isFieldInvalid('orderType')">
                    <option value="">Select Department</option>
                    <option *ngFor="let dept of departmentOptions" [value]="dept.value">
                      {{ dept.label }}
                    </option>
                  </select>
                  <div *ngIf="isFieldInvalid('orderType')" class="field-error">
                    {{ getFieldErrorMessage('orderType') }}
                  </div>
                </div>
              </div>

              <!-- Requester -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-person field-icon"></i>
                    <span>Requester</span>
                    <span class="required-indicator">*</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="text"
                         class="modern-input"
                         formControlName="requester"
                         [class.error]="isFieldInvalid('requester')"
                         placeholder="Enter requester name">
                  <div *ngIf="isFieldInvalid('requester')" class="field-error">
                    {{ getFieldErrorMessage('requester') }}
                  </div>
                </div>
              </div>

              <!-- DCG Part No -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-hash field-icon"></i>
                    <span>DCG P/N#</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="text"
                         class="modern-input"
                         formControlName="dcgPartNo"
                         [class.error]="isFieldInvalid('dcgPartNo')"
                         placeholder="Enter DCG part number">
                </div>
              </div>

              <!-- Manufacturer Part No -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-gear field-icon"></i>
                    <span>Manuf P/N#</span>
                    <span class="required-indicator">*</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="text"
                         class="modern-input"
                         formControlName="manufPartNo"
                         [class.error]="isFieldInvalid('manufPartNo')"
                         placeholder="Enter manufacturer part number">
                  <div *ngIf="isFieldInvalid('manufPartNo')" class="field-error">
                    {{ getFieldErrorMessage('manufPartNo') }}
                  </div>
                </div>
              </div>

              <!-- Qty Needed -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-123 field-icon"></i>
                    <span>Qty Needed</span>
                    <span class="required-indicator">*</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="number"
                         class="modern-input"
                         formControlName="qtyNeeded"
                         min="1" max="99999"
                         pattern="[0-9]*"
                         (keypress)="onNumberKeyPress($event)"
                         (paste)="onNumberPaste($event)"
                         [class.error]="isFieldInvalid('qtyNeeded')"
                         placeholder="Enter quantity">
                  <div *ngIf="isFieldInvalid('qtyNeeded')" class="field-error">
                    {{ getFieldErrorMessage('qtyNeeded') }}
                  </div>
                </div>
              </div>

              <!-- Vendor -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-shop field-icon"></i>
                    <span>Vendor</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="text"
                         class="modern-input"
                         formControlName="vendor"
                         placeholder="Enter vendor name">
                </div>
              </div>

              <!-- PO Number -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-receipt field-icon"></i>
                    <span>PO Number</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="text"
                         class="modern-input"
                         formControlName="poNumber"
                         placeholder="Enter PO number">
                </div>
              </div>

              <!-- Order Date -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-calendar field-icon"></i>
                    <span>Order Date</span>
                    <span class="required-indicator">*</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="date"
                         class="modern-input"
                         formControlName="orderDate"
                         [class.error]="isFieldInvalid('orderDate')">
                  <div *ngIf="isFieldInvalid('orderDate')" class="field-error">
                    {{ getFieldErrorMessage('orderDate') }}
                  </div>
                </div>
              </div>

              <!-- Arrive Date -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-calendar-check field-icon"></i>
                    <span>Arrive Date</span>
                  </label>
                </div>
                <div class="field-input">
                  <input type="date"
                         class="modern-input"
                         formControlName="arriveDate"
                         [class.error]="isFieldInvalid('arriveDate')">
                  <div *ngIf="isFieldInvalid('arriveDate')" class="field-error">
                    {{ getFieldErrorMessage('arriveDate') }}
                  </div>
                </div>
              </div>

              <!-- Status -->
              <div class="form-field">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-flag field-icon"></i>
                    <span>Status</span>
                  </label>
                </div>
                <div class="field-input">
                  <select class="modern-select"
                          formControlName="status"
                          [class.error]="isFieldInvalid('status')">
                    <option *ngFor="let status of statusOptions" [value]="status.value">
                      {{ status.label }}
                    </option>
                  </select>
                </div>
              </div>

              <!-- File Attachments -->
              <div class="form-field full-width">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-paperclip field-icon"></i>
                    <span>Attachments</span>
                  </label>
                </div>
                <div class="field-input">
                  <div class="file-upload-area">
                    <input type="file"
                           id="fileInput"
                           class="file-input"
                           multiple
                           (change)="onFileSelected($event)"
                           accept=".jpg,.jpeg,.gif,.doc,.bmp,.xls,.png,.txt,.xlsx,.docx,.pdf">
                    <label for="fileInput" class="file-upload-label">
                      <div class="upload-icon">
                        <i class="bi bi-cloud-upload"></i>
                      </div>
                      <div class="upload-text">
                        <span class="primary-text">Drop files here or click to browse</span>
                        <span class="secondary-text">Max 5MB â€¢ PDF, DOC, XLS, JPG, PNG, TXT</span>
                      </div>
                    </label>
                  </div>

                  <!-- Selected Files -->
                  <div *ngIf="selectedFiles.length > 0" class="selected-files">
                    <div *ngFor="let file of selectedFiles; let i = index" class="file-item">
                      <div class="file-info">
                        <div class="file-icon">
                          <i class="bi bi-file-earmark"></i>
                        </div>
                        <div class="file-details">
                          <span class="file-name">{{ file.name }}</span>
                          <span class="file-size">{{ (file.size / 1024 / 1024).toFixed(2) }} MB</span>
                        </div>
                      </div>
                      <button type="button"
                              class="remove-file-btn"
                              (click)="removeAttachment(i)"
                              title="Remove file">
                        <i class="bi bi-x"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Notes -->
              <div class="form-field full-width">
                <div class="field-header">
                  <label class="field-label">
                    <i class="bi bi-chat-text field-icon"></i>
                    <span>Notes</span>
                  </label>
                </div>
                <div class="field-input">
                  <textarea class="modern-textarea"
                            formControlName="notes"
                            placeholder="Enter additional notes or comments"
                            rows="4"></textarea>
                </div>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
              <div class="action-buttons">
                <button type="button"
                        class="action-btn secondary"
                        (click)="resetForm()">
                  <i class="bi bi-arrow-clockwise"></i>
                  <span>Reset Form</span>
                </button>

                <button type="button"
                        class="action-btn danger"
                        (click)="deleteOrderRequest()"
                        [disabled]="isFormSubmitting">
                  <i class="bi bi-trash"></i>
                  <span>Delete</span>
                </button>

                <button type="submit"
                        class="action-btn primary"
                        [disabled]="isFormSubmitting || orderRequestForm.invalid">
                  <i class="bi bi-check-circle" *ngIf="!isFormSubmitting"></i>
                  <div class="button-spinner" *ngIf="isFormSubmitting"></div>
                  <span>{{ isFormSubmitting ? 'Saving...' : 'Save Request' }}</span>
                </button>
              </div>
            </div>

          </form>
        </div>
      </div>
    </div>

  </div> <!-- end *ngIf="!isLoading" -->

</div> <!-- END Order Request Container -->
