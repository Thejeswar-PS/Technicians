<!-- DTech Users Search Component - Professional Design -->
<div class="dtech-users-container">
  <!-- Loading Screen -->
  <div class="dtech-users-loading" *ngIf="isLoading">
    <div class="d-flex justify-content-center align-items-center h-100">
      <div class="text-center">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p class="loading-message">Loading DTech Users...</p>
      </div>
    </div>
  </div>

  <!-- Page Title -->
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary mb-0">DTech Users Search</h2>
  </div>

  <div class="container-fluid">
    <!-- Messages Section -->
    <div class="message-section mb-4" *ngIf="successMessage || errorMessage">
      <div class="modern-alert success" *ngIf="successMessage">
        <div class="alert-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        <div class="alert-content">
          <div class="alert-message">{{ successMessage }}</div>
        </div>
      </div>
      
      <div class="modern-alert error" *ngIf="errorMessage">
        <div class="alert-icon">
          <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="alert-content">
          <div class="alert-message">{{ errorMessage }}</div>
        </div>
      </div>
    </div>

    <!-- Search Form Card -->
    <div class="main-section mb-4">
      <div class="section-body">
        <!-- Search Form -->
        <form [formGroup]="filterForm" (ngSubmit)="searchUsers()" class="modern-form">
          <div class="form-grid">
            <!-- Login -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-sign-in-alt text-primary"></i>
                  Login
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="login"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Site ID -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-map-marker-alt text-primary"></i>
                  Site ID
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="siteID"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Customer Name -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-building text-primary"></i>
                  Customer Name
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="custName"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Address -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-home text-primary"></i>
                  Address
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="address"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Phone -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-phone text-primary"></i>
                  Phone
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="tel" 
                  class="form-control modern-input" 
                  formControlName="phone"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Email -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-envelope text-primary"></i>
                  Email
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="email" 
                  class="form-control modern-input" 
                  formControlName="email"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Contact Name -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-user text-primary"></i>
                  Contact Name
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="contact"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Serial / Asset ID -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-barcode text-primary"></i>
                  Serial / Asset ID
                </label>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="svcSerialId"
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-section">
            <div class="action-buttons">
              <button 
                type="submit" 
                class="btn action-btn primary-action"
                [disabled]="filterForm.invalid || isLoading">
                <i class="fas fa-search me-2"></i>
                <span>Search Users</span>
                <div class="btn-loader" *ngIf="isLoading"></div>
              </button>
              
              <button 
                type="button" 
                class="btn action-btn secondary-action"
                (click)="clearFilters()"
                [disabled]="isLoading">
                <i class="fas fa-times me-2"></i>Clear Search
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Results Section -->
    <div class="main-section" *ngIf="displayedData.length > 0">
      <div class="section-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0 fw-bold">Search Results</h4>
          <span class="badge" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">{{ totalRecords }} Results</span>
        </div>
        
        <div class="table-responsive">
          <table class="table app-table mb-0">
            <thead class="app-table-header">
              <tr>
                <th class="fw-bold sortable" (click)="sortData('login')">
                  <span class="header-cell">
                    Login
                    <span class="sort-icons" [class.active]="sortedColumn === 'login'">
                      <i class="up" [class.on]="sortedColumn === 'login' && sortDirection === 1"></i>
                      <i class="down" [class.on]="sortedColumn === 'login' && sortDirection === -1"></i>
                    </span>
                  </span>
                </th>
                <th>Password</th>
                <th class="fw-bold sortable" (click)="sortData('siteID')">
                  <span class="header-cell">
                    Site ID
                    <span class="sort-icons" [class.active]="sortedColumn === 'siteID'">
                      <i class="up" [class.on]="sortedColumn === 'siteID' && sortDirection === 1"></i>
                      <i class="down" [class.on]="sortedColumn === 'siteID' && sortDirection === -1"></i>
                    </span>
                  </span>
                </th>
                <th>Customer</th>
                <th>Address</th>
                <th>Contact</th>
                <th>Phone</th>
                <th>Email</th>
                <th class="fw-bold sortable" (click)="sortData('lastLoggedIn')">
                  <span class="header-cell">
                    Last Login
                    <span class="sort-icons" [class.active]="sortedColumn === 'lastLoggedIn'">
                      <i class="up" [class.on]="sortedColumn === 'lastLoggedIn' && sortDirection === 1"></i>
                      <i class="down" [class.on]="sortedColumn === 'lastLoggedIn' && sortDirection === -1"></i>
                    </span>
                  </span>
                </th>
                <th class="fw-bold sortable" (click)="sortData('lastChangedPwd')">
                  <span class="header-cell">
                    Pwd Changed
                    <span class="sort-icons" [class.active]="sortedColumn === 'lastChangedPwd'">
                      <i class="up" [class.on]="sortedColumn === 'lastChangedPwd' && sortDirection === 1"></i>
                      <i class="down" [class.on]="sortedColumn === 'lastChangedPwd' && sortDirection === -1"></i>
                    </span>
                  </span>
                </th>
              </tr>
            </thead>
            <tbody class="app-table-body">
              <tr *ngFor="let user of displayedData; index as i" 
                  class="app-table-row">
                <td class="login-cell">
                  <div class="cell-content">
                    <span class="text-primary fw-bold">{{ user.login }}</span>
                  </div>
                </td>
                <td class="password-cell">
                  <div class="cell-content">
                    <span>{{ user.password || 'N/A' }}</span>
                  </div>
                </td>
                <td class="site-cell">
                  <div class="cell-content">
                    <span class="badge bg-light text-primary">{{ user.siteID }}</span>
                  </div>
                </td>
                <td class="customer-cell">
                  <div class="cell-content truncate">
                    <span class="fw-semibold">{{ user.custName }}</span>
                  </div>
                </td>
                <td class="address-cell">
                  <div class="cell-content truncate">
                    <span>{{ user.address }}</span>
                  </div>
                </td>
                <td class="contact-cell">
                  <div class="cell-content truncate">
                    <span>{{ user.contact }}</span>
                  </div>
                </td>
                <td class="phone-cell">
                  <div class="cell-content">
                    <span class="text-info">{{ user.phone }}</span>
                  </div>
                </td>
                <td class="email-cell">
                  <div class="cell-content truncate">
                    <span style="color: #1bc505;">{{ user.email }}</span>
                  </div>
                </td>
                <td class="login-date-cell">
                  <div class="cell-content">
                    <div class="date-info">
                      <span class="date-main">{{ formatDate(user.lastLoggedIn) }}</span>
                    </div>
                  </div>
                </td>
                <td class="pwd-date-cell">
                  <div class="cell-content">
                    <div class="date-info">
                      <span class="date-main">{{ formatDate(user.lastChangedPwd) }}</span>
                      <div class="mt-1" *ngIf="isPasswordOld(user.lastChangedPwd)">
                        <span class="badge bg-warning text-dark">Old</span>
                      </div>
                      <div class="mt-1" *ngIf="isPasswordRecent(user.lastChangedPwd)">
                        <span class="badge bg-success">Recent</span>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- No Results Message -->
    <div class="main-section" *ngIf="isFiltered && totalRecords === 0 && !isLoading">
      <div class="section-body">
        <div class="no-results-content">
          <div class="no-results-icon-wrapper">
            <i class="fas fa-search-minus no-results-icon"></i>
          </div>
          <h4 class="no-results-title">No Users Found</h4>
          <p class="no-results-message">
            No users match your search criteria. Try adjusting your search terms or check your spelling.
          </p>
          <div class="no-results-suggestions">
            <h6>Search Tips:</h6>
            <ul>
              <li>Try partial usernames or email addresses</li>
              <li>Check for typos in your search terms</li>
              <li>Use different search criteria</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>