<!-- DTech Users Search Component - Professional Design -->
<div class="dtech-users-container">
  <!-- Loading Screen -->
  <div class="dtech-users-loading" *ngIf="isLoading">
    <div class="d-flex justify-content-center align-items-center h-100">
      <div class="text-center">
        <div class="spinner-border" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p class="loading-message">Loading DTech Users...</p>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <!-- Professional Header Section -->
    <div class="row mb-0">
      <div class="col-12">
        <div class="dtech-users-header__top d-flex align-items-center justify-content-between">
          <button 
            class="btn btn-primary dtech-users-header__back" 
            (click)="router.navigate(['/reports'])"
            type="button">
            <i class="fas fa-arrow-left me-2"></i>Back
          </button>
          
          <div class="dtech-users-page-title">
            <h2>
              <i class="fas fa-users me-2"></i>DTech Users Search
            </h2>
          </div>

          <div class="header-spacer"></div>
        </div>
      </div>
    </div>

    <!-- Main Content Card -->
    <div class="card dtech-main-card">
      <!-- Messages Section -->
      <div class="message-section" *ngIf="successMessage || errorMessage">
        <div class="modern-alert success" *ngIf="successMessage">
          <div class="alert-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="alert-content">
            <div class="alert-message">{{ successMessage }}</div>
          </div>
        </div>
        
        <div class="modern-alert error" *ngIf="errorMessage">
          <div class="alert-icon">
            <i class="fas fa-exclamation-circle"></i>
          </div>
          <div class="alert-content">
            <div class="alert-message">{{ errorMessage }}</div>
          </div>
        </div>
      </div>

      <!-- Form Content -->
      <div class="form-content">
        <!-- Loading Overlay -->
        <div class="loading-overlay" *ngIf="isLoading">
          <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Searching Users...</div>
          </div>
        </div>

        <!-- Search Form -->
        <form [formGroup]="filterForm" (ngSubmit)="searchUsers()" class="modern-form">
          <div class="form-section-title">
            <h4>
              <i class="fas fa-search me-2"></i>Search Criteria
            </h4>
            <p>Enter search criteria to find DTech users in the system</p>
          </div>

          <div class="form-grid">
            <!-- Login -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-sign-in-alt text-primary"></i>
                  Login
                </label>
                <span class="field-hint">Search by login name</span>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="login"
                  placeholder="Enter login name..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Site ID -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-map-marker-alt text-primary"></i>
                  Site ID
                </label>
                <span class="field-hint">Search by site identifier</span>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="siteID"
                  placeholder="Enter site ID..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Customer Name -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-building text-primary"></i>
                  Customer Name
                </label>
                <span class="field-hint">Search by customer name</span>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="custName"
                  placeholder="Enter customer name..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Address -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-home text-primary"></i>
                  Address
                </label>
                <span class="field-hint">Search by address</span>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="address"
                  placeholder="Enter address..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Phone -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-phone text-primary"></i>
                  Phone
                </label>
                <span class="field-hint">Search by phone number</span>
              </div>
              <div class="field-input">
                <input 
                  type="tel" 
                  class="form-control modern-input" 
                  formControlName="phone"
                  placeholder="Enter phone number..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Email -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-envelope text-primary"></i>
                  Email
                </label>
                <span class="field-hint">Search by email address</span>
              </div>
              <div class="field-input">
                <input 
                  type="email" 
                  class="form-control modern-input" 
                  formControlName="email"
                  placeholder="Enter email address..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Contact Name -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-user text-primary"></i>
                  Contact Name
                </label>
                <span class="field-hint">Search by contact person</span>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="contact"
                  placeholder="Enter contact name..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>

            <!-- Serial / Asset ID -->
            <div class="form-field">
              <div class="field-header">
                <label class="field-label">
                  <i class="fas fa-barcode text-primary"></i>
                  Serial / Asset ID
                </label>
                <span class="field-hint">Search by serial or asset ID</span>
              </div>
              <div class="field-input">
                <input 
                  type="text" 
                  class="form-control modern-input" 
                  formControlName="svcSerialId"
                  placeholder="Enter serial or asset ID..."
                  autocomplete="off">
                <div class="input-focus-border"></div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-section">
            <div class="action-buttons">
              <button 
                type="submit" 
                class="btn action-btn primary-action"
                [disabled]="filterForm.invalid || isLoading">
                <i class="fas fa-search me-2"></i>
                <span>Search Users</span>
                <div class="btn-loader" *ngIf="isLoading"></div>
              </button>
              
              <button 
                type="button" 
                class="btn action-btn secondary-action"
                (click)="clearFilters()"
                [disabled]="isLoading">
                <i class="fas fa-times me-2"></i>Clear Search
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- Results Section -->
    <div class="card dtech-results-card" *ngIf="displayedData.length > 0">
      <div class="card-header results-header">
        <div class="results-header-content">
          <div class="results-title-section">
            <h4 class="results-title">
              <i class="fas fa-list-ul me-2"></i>Search Results
            </h4>
            <div class="results-meta">
              <span class="results-count">{{ totalRecords }} users found</span>
            </div>
          </div>
          <div class="results-actions">
            <button class="btn btn-outline-primary btn-sm export-btn">
              <i class="fas fa-download me-1"></i>Export
            </button>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <div class="results-table-container">
          <table class="table results-table mb-0">
            <thead class="table-header">
              <tr>
                <th class="sortable-header col-login">
                  <span>Login</span>
                  <i class="fas fa-sort"></i>
                </th>
                <th class="col-password">Password</th>
                <th class="sortable-header col-site">
                  <span>Site ID</span>
                  <i class="fas fa-sort"></i>
                </th>
                <th class="col-customer">Customer</th>
                <th class="col-address">Address</th>
                <th class="col-contact">Contact</th>
                <th class="col-phone">Phone</th>
                <th class="col-email">Email</th>
                <th class="sortable-header col-login-date">
                  <span>Last Login</span>
                  <i class="fas fa-sort"></i>
                </th>
                <th class="sortable-header col-pwd-date">
                  <span>Pwd Changed</span>
                  <i class="fas fa-sort"></i>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of displayedData; index as i" 
                  class="result-row" 
                  [class.even]="i % 2 === 0"
                  [class.odd]="i % 2 === 1">
                <td class="login-cell">
                  <div class="cell-content">
                    <span class="text-primary fw-bold">{{ user.login }}</span>
                  </div>
                </td>
                <td class="password-cell">
                  <div class="cell-content">
                    <span class="password-mask">{{ user.password ? '••••••' : 'N/A' }}</span>
                  </div>
                </td>
                <td class="site-cell">
                  <div class="cell-content">
                    <span class="badge bg-light text-primary">{{ user.siteID }}</span>
                  </div>
                </td>
                <td class="customer-cell">
                  <div class="cell-content truncate">
                    <span class="fw-semibold">{{ user.custName }}</span>
                  </div>
                </td>
                <td class="address-cell">
                  <div class="cell-content truncate">
                    <span class="text-muted">{{ user.address }}</span>
                  </div>
                </td>
                <td class="contact-cell">
                  <div class="cell-content truncate">
                    <span>{{ user.contact }}</span>
                  </div>
                </td>
                <td class="phone-cell">
                  <div class="cell-content">
                    <span class="text-info">{{ user.phone }}</span>
                  </div>
                </td>
                <td class="email-cell">
                  <div class="cell-content truncate">
                    <span class="text-success">{{ user.email }}</span>
                  </div>
                </td>
                <td class="login-date-cell">
                  <div class="cell-content">
                    <div class="date-info">
                      <span class="date-main">{{ formatDate(user.lastLoggedIn) }}</span>
                    </div>
                  </div>
                </td>
                <td class="pwd-date-cell">
                  <div class="cell-content">
                    <div class="date-info">
                      <span class="date-main">{{ formatDate(user.lastChangedPwd) }}</span>
                      <div class="mt-1" *ngIf="isPasswordOld(user.lastChangedPwd)">
                        <span class="badge bg-warning text-dark">Old</span>
                      </div>
                      <div class="mt-1" *ngIf="isPasswordRecent(user.lastChangedPwd)">
                        <span class="badge bg-success">Recent</span>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- No Results Message -->
    <div class="card no-results-card" *ngIf="isFiltered && totalRecords === 0 && !isLoading">
      <div class="card-body">
        <div class="no-results-content">
          <div class="no-results-icon-wrapper">
            <i class="fas fa-search-minus no-results-icon"></i>
          </div>
          <h4 class="no-results-title">No Users Found</h4>
          <p class="no-results-message">
            No users match your search criteria. Try adjusting your search terms or check your spelling.
          </p>
          <div class="no-results-suggestions">
            <h6>Search Tips:</h6>
            <ul>
              <li>Try partial usernames or email addresses</li>
              <li>Check for typos in your search terms</li>
              <li>Use different search criteria</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>