<!-- DCG Employee Details Page -->
<div class="container-fluid dcg-employee-container">
  <!-- Loading spinner -->
  <div
    *ngIf="isLoading"
    class="d-flex justify-content-center align-items-center dcg-employee-loading"
  >
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Header Section -->
  <div class="dcg-employee-header__top mb-4 d-flex justify-content-center align-items-center">
    <!-- Page Title - Centered -->
    <div class="dcg-employee-page-title">
      <h2 class="fw-bold text-primary mb-0 text-center">
        <i class="bi bi-people me-2"></i>
        DCG Employee Details
      </h2>
    </div>
  </div>

  <!-- Main content -->
  <div *ngIf="!isLoading">
    <!-- Grid Type Toggle & Data Section -->
    <div class="card shadow-sm dcg-main-card">
      <!-- Header with Grid Toggle -->
      <div class="card-header border-0 py-4">
        <div class="dcg-filter-header">
          <!-- Grid Toggle and Sort Controls -->
          <div class="filter-controls-section">
            <div class="d-flex align-items-center">
              <!-- Left side - View Type Only -->
              <div class="d-flex align-items-center me-5">
                <!-- View Type Segmented Control -->
                <div class="d-flex align-items-center">
                  <label class="control-label me-3">View Type</label>
                  <div class="segmented-control" role="group">
                  <button 
                    type="button" 
                    class="segment-btn"
                    [class.active]="currentGridType === GridType.Employee"
                    (click)="switchGrid(GridType.Employee)"
                    [disabled]="isLoading">
                    <i class="bi bi-person me-1"></i>
                    Employees
                  </button>
                  <button 
                    type="button" 
                    class="segment-btn"
                    [class.active]="currentGridType === GridType.Inventory"
                    (click)="switchGrid(GridType.Inventory)"
                    [disabled]="isLoading">
                    <i class="bi bi-building me-1"></i>
                    Inventory Regions
                  </button>
                </div>
              </div>
              </div>

              <!-- Right side - Add Button and Search Box -->
              <div class="d-flex align-items-center gap-3 ms-auto">
                <button
                  type="button"
                  class="btn btn-primary add-btn"
                  (click)="isEmployeeGrid ? showAddEmployee() : showAddOfficeAssignment()"
                  [disabled]="isLoading"
                >
                  <i class="bi bi-plus me-1"></i>
                  Add {{ isEmployeeGrid ? 'Employee' : 'Inventory Region' }}
                </button>
                
                <!-- Search Box -->
                <div class="search-container-inline">
                  <div class="input-group input-group-sm">
                    <input 
                      type="text" 
                      class="form-control" 
                      placeholder="search employee"
                      [(ngModel)]="searchTerm"
                      (input)="onSearchChange()"
                    >
                    <button 
                      class="btn btn-primary btn-sm" 
                      type="button"
                      (click)="performSearch()"
                      title="Search">
                      <i class="bi bi-search"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Data Display Section -->
      <div class="card-body py-4">
        
        <!-- Messages -->
        <div class="dcg-messages" *ngIf="errorMessage || successMessage">
          <div class="alert alert-danger d-inline-flex align-items-center" *ngIf="errorMessage">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span>{{ errorMessage }}</span>
          </div>
          <div class="alert alert-success d-inline-flex align-items-center" *ngIf="successMessage">
            <i class="bi bi-check-circle-fill me-2"></i>
            <span>{{ successMessage }}</span>
          </div>
        </div>

        <!-- Data Table Section -->
        <div class="table-section">
          
          <!-- Pagination Controls at Top -->
          <div *ngIf="totalItems > 0 && !isLoading" class="d-flex align-items-center justify-content-between mb-3">
            <!-- Records Per Page -->
            <div class="d-flex align-items-center">
              <label class="me-2 fw-semibold">Records per page:</label>
              <select class="form-select form-select-sm w-auto" 
                      [value]="pageSize" 
                      (change)="changePageSize(+$any($event.target).value)">
                <option value="200">200</option>
                <option value="300">300</option>
                <option value="400">400</option>
                <option value="100">100</option>
              </select>
            </div>
            
            <!-- Results Summary -->
            <div class="flex-fill text-center fw-semibold">
              Showing {{ startRecord }}-{{ endRecord }} of {{ totalItems }} records
            </div>
            
            <!-- Page Navigation -->
            <div class="d-flex align-items-center gap-2">
              <button type="button" 
                      class="btn btn-sm btn-outline-secondary" 
                      [disabled]="currentPage <= 1"
                      (click)="goToPage(currentPage - 1)">
                Prev
              </button>
              
              <span class="fw-semibold">Page {{ currentPage }} of {{ totalPages }}</span>
              
              <button type="button" 
                      class="btn btn-sm btn-outline-secondary" 
                      [disabled]="currentPage >= totalPages"
                      (click)="goToPage(currentPage + 1)">
                Next
              </button>
            </div>
          </div>

          <div class="table-responsive">
            
            <!-- Employee Grid -->
            <table class="table table-hover table-bordered mb-0" *ngIf="isEmployeeGrid">
              <thead class="table-light">
                <tr>
                  <th class="fw-bold sortable" (click)="sortTable('empNo')">
                    <span class="header-cell">
                      Emp No
                      <span class="sort-icons" [class.active]="sortColumn === 'empNo'">
                        <i class="up" [class.on]="sortColumn === 'empNo' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'empNo' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('empID')">
                    <span class="header-cell">
                      Employee ID
                      <span class="sort-icons" [class.active]="sortColumn === 'empID'">
                        <i class="up" [class.on]="sortColumn === 'empID' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'empID' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('empName')">
                    <span class="header-cell">
                      Employee Name
                      <span class="sort-icons" [class.active]="sortColumn === 'empName'">
                        <i class="up" [class.on]="sortColumn === 'empName' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'empName' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable text-center" (click)="sortTable('empStatus')">
                    <span class="header-cell">
                      Status
                      <span class="sort-icons" [class.active]="sortColumn === 'empStatus'">
                        <i class="up" [class.on]="sortColumn === 'empStatus' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'empStatus' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('windowsID')">
                    <span class="header-cell">
                      Windows ID
                      <span class="sort-icons" [class.active]="sortColumn === 'windowsID'">
                        <i class="up" [class.on]="sortColumn === 'windowsID' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'windowsID' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('email')">
                    <span class="header-cell">
                      Email
                      <span class="sort-icons" [class.active]="sortColumn === 'email'">
                        <i class="up" [class.on]="sortColumn === 'email' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'email' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold text-center">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                <!-- No Data Message -->
                <tr *ngIf="!paginatedEmployees || paginatedEmployees.length === 0">
                  <td colspan="7" class="text-center py-5">
                    <div class="d-flex flex-column align-items-center text-muted">
                      <i class="bi bi-inbox fs-1 mb-3" style="color: #6c757d;"></i>
                      <h5 class="fw-bold mb-2">No Data Available</h5>
                      <p class="mb-0">No employees available for the selected criteria.</p>
                    </div>
                  </td>
                </tr>
                
                <!-- Data Rows -->
                <tr *ngFor="let employee of paginatedEmployees">
                  <td class="text-center">{{ employee.empNo }}</td>
                  <td>{{ employee.empID || 'N/A' }}</td>
                  <td>{{ employee.empName || 'N/A' }}</td>
                  <td class="text-center">{{ employee.empStatus || 'N/A' }}</td>
                  <td>{{ employee.windowsID || 'N/A' }}</td>
                  <td>{{ employee.email || 'N/A' }}</td>
                  <td class="text-center">
                    <div class="d-flex gap-1 justify-content-center">
                      <button class="btn btn-primary btn-sm" 
                              (click)="editEmployee(employee)"
                              [disabled]="isLoading"
                              title="Edit Employee">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-danger btn-sm" 
                              (click)="deleteEmployee(employee)"
                              [disabled]="isLoading"
                              title="Delete Employee">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

            <!-- Inventory Region Grid -->
            <table class="table table-hover table-bordered mb-0" *ngIf="isOfficeGrid">
              <thead class="table-light">
                <tr>
                  <th class="fw-bold sortable" (click)="sortTable('state')">
                    <span class="header-cell">
                      State
                      <span class="sort-icons" [class.active]="sortColumn === 'state'">
                        <i class="up" [class.on]="sortColumn === 'state' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'state' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('stateName')">
                    <span class="header-cell">
                      State Name
                      <span class="sort-icons" [class.active]="sortColumn === 'stateName'">
                        <i class="up" [class.on]="sortColumn === 'stateName' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'stateName' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable text-center" (click)="sortTable('offID')">
                    <span class="header-cell">
                      Office ID
                      <span class="sort-icons" [class.active]="sortColumn === 'offID'">
                        <i class="up" [class.on]="sortColumn === 'offID' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'offID' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('invUserID')">
                    <span class="header-cell">
                      Inventory User ID
                      <span class="sort-icons" [class.active]="sortColumn === 'invUserID'">
                        <i class="up" [class.on]="sortColumn === 'invUserID' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'invUserID' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold sortable" (click)="sortTable('subRegion')">
                    <span class="header-cell">
                      Sub Region
                      <span class="sort-icons" [class.active]="sortColumn === 'subRegion'">
                        <i class="up" [class.on]="sortColumn === 'subRegion' && sortDirection === 'asc'"></i>
                        <i class="down" [class.on]="sortColumn === 'subRegion' && sortDirection === 'desc'"></i>
                      </span>
                    </span>
                  </th>
                  <th class="fw-bold text-center">
                    Actions
                  </th>
                </tr>
              </thead>
              <tbody>
                <!-- No Data Message -->
                <tr *ngIf="!paginatedOfficeAssignments || paginatedOfficeAssignments.length === 0">
                  <td colspan="6" class="text-center py-5">
                    <div class="d-flex flex-column align-items-center text-muted">
                      <i class="bi bi-inbox fs-1 mb-3" style="color: #6c757d;"></i>
                      <h5 class="fw-bold mb-2">No Data Available</h5>
                      <p class="mb-0">No inventory regions available for the selected criteria.</p>
                    </div>
                  </td>
                </tr>
                
                <!-- Data Rows -->
                <tr *ngFor="let office of paginatedOfficeAssignments">
                  <td class="text-center">{{ office.state }}</td>
                  <td>{{ office.stateName || 'N/A' }}</td>
                  <td class="text-center">{{ office.offID }}</td>
                  <td>{{ office.invUserID || 'N/A' }}</td>
                  <td>{{ office.subRegion || 'N/A' }}</td>
                  <td class="text-center">
                    <div class="d-flex gap-1 justify-content-center">
                      <button class="btn btn-primary btn-sm" 
                              (click)="editOfficeAssignment(office)"
                              [disabled]="isLoading"
                              title="Edit Office Assignment">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-danger btn-sm" 
                              (click)="deleteOfficeAssignment(office)"
                              [disabled]="isLoading"
                              title="Delete Office Assignment">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Empty State -->
        <div *ngIf="totalItems === 0 && !isLoading" class="empty-state">
          <div class="empty-state-content">
            <i class="bi bi-inbox empty-icon"></i>
            <h4 class="empty-title">No {{ isEmployeeGrid ? 'Employees' : 'Inventory Regions' }} Found</h4>
            <p class="empty-text">There are no {{ isEmployeeGrid ? 'employees' : 'inventory regions' }} to display.</p>
            <button class="btn btn-primary" (click)="isEmployeeGrid ? showAddEmployee() : showAddOfficeAssignment()">
              <i class="bi bi-plus-lg me-2"></i>Add {{ isEmployeeGrid ? 'Employee' : 'Inventory Region' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Employee Modal -->
<div class="modal-overlay" *ngIf="showEmployeeForm" (click)="hideEmployeeModal()">
  <div class="modal-dialog modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-person-plus me-2"></i>
          {{ modalTitle }}
        </h5>
        <button type="button" class="btn-close" (click)="hideEmployeeModal()">
          <i class="bi bi-x"></i>
        </button>
      </div>
      <form [formGroup]="employeeForm" (ngSubmit)="saveEmployee()">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-bold required">Employee ID</label>
              <input type="text" 
                     class="form-control" 
                     formControlName="empID"
                     [class.is-invalid]="isFieldInvalid(employeeForm, 'empID')"
                     placeholder="Enter Employee ID">
              <div class="invalid-feedback">{{ getFieldError(employeeForm, 'empID') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold required">Employee Name</label>
              <input type="text" 
                     class="form-control" 
                     formControlName="empName"
                     [class.is-invalid]="isFieldInvalid(employeeForm, 'empName')"
                     placeholder="Enter Employee Name">
              <div class="invalid-feedback">{{ getFieldError(employeeForm, 'empName') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold required">Status</label>
              <input type="text" 
                     class="form-control" 
                     formControlName="empStatus"
                     [class.is-invalid]="isFieldInvalid(employeeForm, 'empStatus')"
                     placeholder="Enter Status">
              <div class="invalid-feedback">{{ getFieldError(employeeForm, 'empStatus') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold required">Windows ID</label>
              <input type="text" 
                     class="form-control" 
                     formControlName="windowsID"
                     [class.is-invalid]="isFieldInvalid(employeeForm, 'windowsID')"
                     placeholder="Enter Windows ID">
              <div class="invalid-feedback">{{ getFieldError(employeeForm, 'windowsID') }}</div>
            </div>
            <div class="col-md-12">
              <label class="form-label fw-bold required">Email</label>
              <input type="email" 
                     class="form-control" 
                     formControlName="email"
                     [class.is-invalid]="isFieldInvalid(employeeForm, 'email')"
                     placeholder="Enter Email Address">
              <div class="invalid-feedback">{{ getFieldError(employeeForm, 'email') }}</div>
            </div>
          </div>
        </div>
        <div class="modal-footer d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-secondary" (click)="hideEmployeeModal()" [disabled]="isSubmitting">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || (employeeForm.invalid && !editingEmployee)">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi bi-save me-1" *ngIf="!isSubmitting"></i>
            {{ editingEmployee ? 'Update' : 'Save' }} Employee
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Inventory Region Modal -->
<div class="modal-overlay" *ngIf="showOfficeForm" (click)="hideOfficeModal()">
  <div class="modal-dialog modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-geo-alt-fill me-2"></i>
          {{ modalTitle }}
        </h5>
        <button type="button" class="btn-close" (click)="hideOfficeModal()">
          <i class="bi bi-x"></i>
        </button>
      </div>
      <form [formGroup]="officeForm" (ngSubmit)="saveOfficeAssignment()">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-bold required">State</label>
              <select class="form-select" 
                      formControlName="state"
                      (change)="onStateChange()"
                      [class.is-invalid]="isFieldInvalid(officeForm, 'state')">
                <option value="">Select State</option>
                <option *ngFor="let state of stateOptions" [value]="state.state">
                  {{ state.state }} - {{ state.stateName }}
                </option>
              </select>
              <div class="invalid-feedback">{{ getFieldError(officeForm, 'state') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold required">State Name</label>
              <select class="form-select" 
                      formControlName="stateName"
                      (change)="onStateNameChange()"
                      [class.is-invalid]="isFieldInvalid(officeForm, 'stateName')">
                <option value="">Select State Name</option>
                <option *ngFor="let state of stateOptions" [value]="state.stateName">
                  {{ state.stateName }}
                </option>
              </select>
              <div class="invalid-feedback">{{ getFieldError(officeForm, 'stateName') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold required">Office ID (Manager)</label>
              <input type="text" 
                     class="form-control" 
                     formControlName="offID"
                     [class.is-invalid]="isFieldInvalid(officeForm, 'offID')"
                     placeholder="Enter Office ID">
              <div class="invalid-feedback">{{ getFieldError(officeForm, 'offID') }}</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold required">Inventory User ID (Parts Employee)</label>
              <input type="text" 
                     class="form-control" 
                     formControlName="invUserID"
                     [class.is-invalid]="isFieldInvalid(officeForm, 'invUserID')"
                     placeholder="Enter Inventory User ID">
              <div class="invalid-feedback">{{ getFieldError(officeForm, 'invUserID') }}</div>
            </div>
          </div>
        </div>
        <div class="modal-footer d-flex gap-2 justify-content-end">
          <button type="button" class="btn btn-secondary" (click)="hideOfficeModal()" [disabled]="isSubmitting">
            Cancel
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="isSubmitting || officeForm.invalid">
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            <i class="bi bi-save me-1" *ngIf="!isSubmitting"></i>
            {{ editingOffice ? 'Update' : 'Save' }} Inventory Region
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
