<!-- begin::Header -->
<div class="table-container-width table-invisible">

  <div class="card">
    <div class="card-body border-0 pt-5">

      <form [formGroup]="jobFilterForm" novalidate="" class="form">
        <table>
          <tr>
            <td>
              <label class="min-w-100px me-5 fw-bold mb-1 fs-6">Tech</label>
            </td>
            <td>
              <label class="min-w-100px me-5 fw-bold mb-1 fs-6">Account Manager</label>
            </td>
            <td>
              <label class="min-w-100px me-5 fw-bold mb-1 fs-6">Archive</label>
            </td>
            <td>
              <label class="min-w-100px me-5 fw-bold mb-1 fs-6">Fiscal Year</label>
            </td>
            <td>
              <label class="min-w-100px me-5 fw-bold mb-1 fs-6">Month</label>
            </td>
            <td>
              <label class="min-w-100px me-5 fw-bold mb-1 fs-6">Search Job</label>
            </td>
            <td></td>
          </tr>
          <tr>
            <td>
              <select
                class="form-select form-select-solid fw-bold text-dark fs-6 me-5"
                formControlName="techId"
                style="width:150px;padding:4px;"
              >
                <option class="fw-bold text-dark me-5" value="All" selected>All</option>
                <option class="fw-bold text-dark me-5" *ngFor="let tech of technicians" [value]="tech.TechID">
                  {{tech.TechName}}
                </option>
              </select>
            </td>
            <td>
              <select
                class="form-select form-select-solid fw-bold text-dark fs-6 me-5"
                formControlName="mgrId"
                style="width:150px;padding:4px;"
                [disabled]="userRole === 'Technician'"
              >
                <option class="fw-bold text-dark me-5" value="All" selected>All</option>
                <option class="fw-bold text-dark me-5" *ngFor="let mgr of accountManagers" [value]="mgr.offname?.toUpperCase()">
                  {{mgr.offname}}
                </option>
              </select>
            </td>
            <td>
              <select
                class="form-select form-select-solid fw-bold text-dark fs-6 me-5"
                formControlName="rbButton"
                style="width:100px;padding:4px;"
              >
                <option class="fw-bold text-dark me-5" value="0" selected>Active</option>
                <option class="fw-bold text-dark me-5" value="1">Archive</option>
              </select>
            </td>
            <td>
              <select
                class="form-select form-select-solid fw-bold text-dark fs-6 me-5"
                formControlName="currentYear"
                style="width:100px;padding:4px;"
              >
                <option class="fw-bold text-dark me-5" *ngFor="let year of fiscalYears" [value]="year">
                  {{year}}
                </option>
              </select>
            </td>
            <td>
              <select
                class="form-select form-select-solid fw-bold text-dark fs-6 me-5"
                formControlName="month"
                style="width:150px;padding:4px;"
              >
                <option class="fw-bold text-dark me-5" *ngFor="let month of months" [value]="month.value">
                  {{month.Text}}
                </option>
              </select>
            </td>
            <td>
              <div class="input-group fw-bold text-dark fs-6">
                <input type="text" class="form-control form-control-sm fw-bold text-dark fs-6" 
                       style="border-color: black;width:100px;" placeholder="Job Number" 
                       formControlName="jobId" (keyup.enter)="SearchJobs()">
                <div class="input-group-append">
                  <button class="btn btn-primary me-2 btn-sm btn-search" type="button" (click)="SearchJobs()">
                    <i class="fa fa-search"></i>
                  </button>
                  <button class="btn btn-primary btn-sm" type="button" (click)="clearSearch()" 
                          *ngIf="jobFilterForm.value.jobId" title="Clear search">
                    <i class="fa fa-times"></i>
                  </button>
                </div>
              </div>
            </td>
            <td>
              <!-- Removed Change Status, Import Jobs, and Export to Excel buttons -->
            </td>
          </tr>
        </table>
      </form>
      
      <!-- Error message display -->
      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
        {{errorMessage}}
      </div>
      
      </div>
  </div>
    <div class="card card-xxl-stretch">
    <div class="card-body py-3">
      <!-- begin::Table container -->
      <div class="table-max-height">
        <!-- begin::Table -->
        <table id="table-to-export" class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4" style="text-align: center;">
          <!-- begin::Table head -->
          <thead>
            <tr class="text-dark fw-bolder badge-light-primary  fs-6">
              <th class="min-w-20px"></th> <!-- Expand/collapse column -->
              <th class="min-w-50px text-hover-primary fs-6" (click)="sortTable('callNbr')" style="cursor: pointer;">Job ID <i class="fa" [ngClass]="sortIcon('callNbr')"></i></th>
              <th class="min-w-100px text-hover-primary fs-6" (click)="sortTable('custName')" style="cursor: pointer;">Site Name <i class="fa" [ngClass]="sortIcon('custName')"></i></th>
              <th class="min-w-100px text-hover-primary fs-6" (click)="sortTable('address')" style="cursor: pointer;">Address <i class="fa" [ngClass]="sortIcon('address')"></i></th>
              <th class="min-w-150px text-hover-primary fs-6" (click)="sortTable('svcDescr')" style="cursor: pointer;">Service Type <i class="fa" [ngClass]="sortIcon('svcDescr')"></i></th>
              <th class="min-w-80px text-hover-primary fs-6" (click)="sortTable('status')" style="cursor: pointer;">Status <i class="fa" [ngClass]="sortIcon('status')"></i></th>
              <th class="min-w-150px text-hover-primary fs-6" (click)="sortTable('techName')" style="cursor: pointer;">Tech-Name <i class="fa" [ngClass]="sortIcon('techName')"></i></th>
              <th class="min-w-150px text-hover-primary fs-6" *ngIf="isAccountManagerColumnVisible()" (click)="sortTable('accMgr')" style="cursor: pointer;">Account Manager <i class="fa" [ngClass]="sortIcon('accMgr')"></i></th>
              <th class="min-w-150px text-hover-primary fs-6" (click)="sortTable('strtDate')" style="cursor: pointer;">Scheduled <i class="fa" [ngClass]="sortIcon('strtDate')"></i></th>
              <th class="min-w-100px text-hover-primary fs-6" (click)="sortTable('returnJob')" style="cursor: pointer;">Uploaded <i class="fa" [ngClass]="sortIcon('returnJob')"></i></th>
              <th class="min-w-50px">$$</th>
              <th class="min-w-50px">Parts</th>
              <th class="min-w-50px">Info</th>
              <th class="min-w-50px">Safety</th>
            </tr>
          </thead>
          <!-- end::Table head -->
          <!-- begin::Table body -->
          <tbody class="text-dark mb-1 fs-6" style="text-align: center; font-family: Roboto condensed;" *ngIf="jobList && jobList.length > 0">
            <ng-container *ngFor="let job of jobList; let i = index;">
              <tr>
                <td style="width: 20px; text-align: center; vertical-align: middle;">
                  <a href="javascript:void(0)" (click)="openEquipementDetailModel((job.callNbr || job.jobID || ''), (job.techName || ''))" 
                     style="cursor: pointer; font-size: 16px; color: #007bff;">
                    <i class="fa" 
                       [ngClass]="isOpenEquipementDetailModel[(job.callNbr || job.jobID || '') + '_' + (job.techName || '')] ? 'fa-minus-square' : 'fa-plus-square'"
                       [title]="isOpenEquipementDetailModel[(job.callNbr || job.jobID || '') + '_' + (job.techName || '')] ? 'Collapse Equipment' : 'Expand Equipment'">
                    </i>
                  </a>
                </td>
                <td>
                  <a href="javascript:void(0)" (click)="navigateToEquipmentDetails(job.callNbr || job.jobID || '', job.techName || '', job.techId || job.techID || '')" 
                     class="text-hover-primary fs-6" style="cursor: pointer; color: #428bca;">
                    {{job.callNbr || job.jobID}}
                  </a>
                </td>
                <td>{{job.custName}}</td>
                <td>{{job.address}}</td>
                <td>{{job.svcDescr}}</td>
                <td>
                  <span [style.color]="getStatusIcon(job.status || '').color"
                        [title]="getStatusIcon(job.status || '').tooltip"
                        style="font-size: 18px; cursor: help;">
                    {{getStatusIcon(job.status || '').symbol}}
                  </span>
                </td>
                <td>{{job.techName}}</td>
                <td *ngIf="isAccountManagerColumnVisible()">{{job.accMgr}}</td>
                <td>{{(job.strDate || job.strtDate) | date:'dd-MMM-yyyy'}}</td>
                <td>{{isValidUploadDate(job.returnJob) ? (job.returnJob | date:'dd-MMM-yyyy') : ''}}</td>
                <td>
                  <a href="javascript:void(0)" (click)="navigateToExpenses((job.callNbr || job.jobID || ''), job.techName, job.techId || job.techID || null)" 
                     style="font-size: 18px; font-weight: bold; color: #28a745; text-decoration: none;" 
                     title="Expenses">
                    $
                  </a>
                </td>
                <td>
                  <a href="javascript:void(0)" (click)="navigateToParts((job.callNbr || job.jobID || ''), job.techName)"
                     style="font-size: 18px; color: #007bff; text-decoration: none;" title="Parts">
                    <i class="bi bi-cart3" style="font-size: 18px; font-weight: bold; color: #28a745; text-decoration: none;"></i>
                  </a>
                </td>
                <td>
                  <a href="javascript:void(0)" (click)="navigateToJobInfo((job.callNbr || job.jobID || ''), job.techName)"
                     style="font-size: 18px; color: #17a2b8; text-decoration: none;" title="Job Info">
                    <i class="bi bi-info-circle" style="font-size: 18px; font-weight: bold; color: #28a745; text-decoration: none;"></i>
                  </a>
                </td>
                <td>
                  <a href="javascript:void(0)" (click)="navigateToSafety((job.callNbr || job.jobID || ''))"
                     style="font-size: 18px; font-weight: bold; color: #28a745; text-decoration: none;" 
                     title="Safety">
                    <i class="bi bi-shield-check" style="font-size: 18px; font-weight: bold; color: #28a745; text-decoration: none;"></i>
                  </a>
                </td>
              </tr>
              
              <!-- Equipment Details Row (expandable) -->
              <ng-container *ngIf="isOpenEquipementDetailModel[(job.callNbr || job.jobID || '') + '_' + (job.techName || '')]">
                <tr>
                  <td style="width: 10px;"></td>
                  <td colspan="100%" style="border: 0px; padding: 8px;">
                    <div style="overflow: auto; border: 0px; position: relative; max-width: 80%;">
                      <table class="table table-bordered table-sm" style="font-size: 10px; margin: 0;">
                        <thead style="background-color: #9370DB; color: white;">
                          <tr>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 60px;">Equip ID</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 100px;">Equip No</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 80px;">Make</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 100px;">Model</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 100px;">Serial No</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 60px;">KVA/Batt</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 150px;">Location</th>
                            <th class="text-center py-1" style="font-size: 10px; min-width: 70px;">Status</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let equipment of getEquipmentForJob((job.callNbr || job.jobID || ''), (job.techName || ''))" 
                              style="height: 22px; background-color: #FFFACD; font-size: 10px;">
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.equipId}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.equipNo?.trim()}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.vendorId?.trim()}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.version?.trim()}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.serialID?.trim()}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.rating}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.location?.trim()}}</td>
                            <td class="text-center py-1" style="color: #0066CC;">{{equipment.codeEquipmentStatus}}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </tbody>
          <!-- end::Table body -->
        </table>
        <!-- end::Table -->
      </div>
      <!-- end::Table container -->
    </div>
    </div>
</div>

  <!-- begin::Body -->
