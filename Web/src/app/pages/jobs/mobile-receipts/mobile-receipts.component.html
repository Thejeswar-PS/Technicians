<!-- Mobile Receipts Page -->
<div class="container py-4 mobile-receipts">

  <!-- Header -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body d-flex justify-content-between align-items-center flex-wrap">
      <button 
        type="button"
        class="btn btn-outline-primary btn-sm mb-2 mb-md-0"
        (click)="goBack()"
        [disabled]="loading">
        <i class="bi bi-arrow-left me-2"></i> Back
      </button>

      <h4 class="fw-bold text-primary text-center flex-grow-1 mb-0">
        Service Call: <span class="text-dark">{{ callNbr }}</span> 
        &nbsp;&nbsp; Tech: <span class="text-dark">{{ techName }}</span>
      </h4>

      <span class="invisible">Placeholder</span>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center my-5">
    <div class="spinner-border text-primary mb-3"></div>
    <p class="fw-semibold text-secondary">Loading mobile receipts...</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="alert alert-danger shadow-sm">
    <i class="bi bi-exclamation-triangle-fill me-2"></i> {{ errorMessage }}
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !errorMessage">

    <!-- Title -->
    <div class="text-center mb-4">
      <h3 class="fw-bolder text-dark">ðŸ“± Uploaded Receipts from mobile app</h3>
    </div>

    <!-- No Data -->
    <div *ngIf="receipts.length === 0" class="alert alert-info shadow-sm text-center">
      <i class="fa fa-info-circle me-2"></i> No mobile receipts found for this job.
    </div>

    <!-- Receipts Grid -->
    <div class="row g-4" *ngIf="receipts.length > 0">
      <div 
        class="col-sm-6 col-md-4 col-lg-3" 
        *ngFor="let receipt of receipts; trackBy: trackByIndex"
        (click)="onImageClick(receipt)"
        style="cursor: pointer;"
      >
        <div class="card h-100 shadow-sm border-0 receipt-card">
          <div class="receipt-image-wrapper">
            <img 
              [src]="getReceiptImageUrl(receipt)"
              [alt]="'Receipt for ' + receipt.codeDesc"
              class="card-img-top receipt-image"
              (error)="onImageError($event)"
            />
          </div>
          <div class="card-body">
            <div class="receipt-description" [innerHTML]="formatReceiptDescription(receipt)"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Zoomed Image Modal -->
  <div 
    *ngIf="showZoomedImage" 
    class="zoomed-image-overlay d-flex justify-content-center align-items-center"
    (click)="closeZoomedImage()"
  >
    <div class="position-relative">
      <img 
        [src]="zoomedImageUrl"
        alt="Zoomed Receipt"
        class="zoomed-image"
        (click)="$event.stopPropagation()"
      />
      <button 
        type="button" 
        class="btn btn-light btn-sm close-btn shadow"
        (click)="closeZoomedImage()">
        <i class="fa fa-times"></i>
      </button>
    </div>
  </div>
</div>
